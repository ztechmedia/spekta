<?php 
if ((strpos(strtolower($_SERVER['SCRIPT_NAME']), strtolower(basename(__FILE__)))) !== false) { // NOT FALSE if the script"s file name is found in the URL
    header('HTTP/1.0 403 Forbidden');
    die('<h2>Direct access to this page is not allowed.</h2>');
}

$script = <<< "JS"
	
function showInputOvertimeTNP(e=null){var t,a=legendGrid(),l=[],r=[],i=[],n={department_id:{url:Overtime("getDepartment"),reload:!0},sub_department_id:{reload:!1},division_id:{reload:!1}};if(e)var s=[{id:"a",text:"Form Lembur",active:!0},{id:"b",text:"Proses Personil"}];else s=[{id:"a",text:"Form Lembur"},{id:"b",text:"Proses Personil",active:!0}];var o=mainTab.cells("tnp_input_overtime").attachTabbar({tabs:s}),d=createTime(),c=[{type:"hidden",name:"ref",value:"-",readonly:!0,required:!0},{type:"combo",name:"department_id",label:"Sub Unit",labelWidth:130,inputWidth:250,readonly:!0,required:!0},{type:"combo",name:"sub_department_id",label:"Bagian",labelWidth:130,inputWidth:250,readonly:!0,required:!0},{type:"combo",name:"division_id",label:"Sub Bagian",labelWidth:130,inputWidth:250,readonly:!0,required:!0},{type:"input",name:"personil",label:"Kebutuhan Orang",labelWidth:130,inputWidth:250,required:!0,validate:"ValidNumeric"},{type:"calendar",name:"overtime_date",label:"Tanggal Lembur",labelWidth:130,inputWidth:250,readonly:!0,required:!0},{type:"combo",name:"start_date",label:"Waktu Mulai",labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:d.startTimes},{type:"combo",name:"end_date",label:"Waktu Selesai",labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:d.endTimes},{type:"input",name:"notes",label:"Catatan",labelWidth:130,inputWidth:250,rows:3}];var u=reqJsonResponse(Overtime("getOTRequirement",{mtn:!0}),"GET",null).data,f=o.cells("a").attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Data Lembur",list:[{type:"block",list:c},{type:"newcolumn"},{type:"fieldset",offsetLeft:30,label:"Kebutuhan Lembur",list:u}]},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"add",className:"button_add",offsetLeft:15,value:"Tambah"},{type:"newcolumn"},{type:"button",name:"clear",className:"button_clear",offsetLeft:30,value:"Clear"}]}]),m=f.getCombo("department_id"),p=f.getCombo("sub_department_id");m.load(Overtime("getDepartment",{equal_id:1})),m.attachEvent("onChange",(function(e,t){clearComboReload(f,"sub_department_id",Overtime("getSubDepartment",{equal_id:5}))})),p.attachEvent("onChange",(function(e,t){clearComboReload(f,"division_id",Emp("getDivision",{subDeptId:e}))})),isFormNumeric(f,["personil"]);var b=f.getCombo("start_date"),_=f.getCombo("end_date");_.selectOption(d.endTimes.length-1),f.attachEvent("onChange",(function(e,t){"start_date"!==e&&"end_date"!==e||checkTime(b,_,["add","clear"],f,"makan")})),checkTime(b,_,["add","clear"],f,"makan"),f.attachEvent("onButtonClick",(function(e){switch(e){case"add":if(!f.validate())return eAlert("Input error!");setDisable(["add","clear"],f,o.cells("a"));let e=new dataProcessor(Overtime("createInitialOvertime",{ref:"-"}));e.init(f),f.save(),e.attachEvent("onAfterUpdate",(function(e,t,a,l){let r=l.getAttribute("message");switch(t){case"inserted":sAlert("Berhasil Menambahkan Record <br>"+r),[],clearAllForm(f,n,null,["start_date","end_date"]),x(),setEnable(["add","clear"],f,o.cells("a"));break;case"error":eaAlert("Kesalahan Waktu Lembur",r),setEnable(["add","clear"],f,o.cells("a"))}}));break;case"clear":clearAllForm(f,n,null,["start_date","end_date"])}}));var h=o.cells("b").attachLayout({pattern:"2E",cells:[{id:"a",text:"Daftar Form Lembur"},{id:"b",text:"Proses Personil",collapse:!0}]});h.cells("a").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"refresh",text:"Refresh",type:"button",img:"refresh.png"},{id:"cancel",text:"Batalkan",type:"button",img:"messagebox_critical.png"},{id:"personil",text:"Update Kebutuhan Personil",type:"button",img:"person_16.png"},{id:"hour_revision",text:"Update Waktu Lembur",type:"button",img:"clock.png"},{id:"production_detail",text:"Detail Lembur Produksi",type:"button",img:"edit.png"}]}).attachEvent("onClick",(function(e){switch(e){case"refresh":x(),formOvtDetailGridTnp.clearAll();break;case"cancel":if(!t.getSelectedRowId())return eAlert("Pilih baris yang akan dibatalkan!");let e=t.cells(t.getSelectedRowId(),1).getValue();dhtmlx.modalbox({type:"alert-warning",title:"Konfirmasi Form Lembur",text:"Anda yakin akan membatalkan lembur "+e+"?",buttons:["Ya","Tidak"],callback:function(t){0==t&&reqJson(Overtime("cancelOvertimeMtn"),"POST",{taskId:e},((e,t)=>{"success"===t.status&&(x(),formOvtDetailGridTnp.clearAll(),h.cells("b").setText("Proses Personil"),h.cells("b").collapse(),l=[],r=[],i=[]),sAlert(t.message)}))}});break;case"personil":if(!t.getSelectedRowId())return eAlert("Pilih baris yang akan dibatalkan!");let p=t.cells(t.getSelectedRowId(),5).getValue().replace(" Orang",""),b=createWindow("change_personil","Update Kebutuhan Orang",500,250);myWins.window("change_personil").skipMyCloseEvent=!0;var a=b.attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Jumlah Kebutuhan Orang",list:[{type:"block",list:[{type:"hidden",name:"task_id",label:"ID",readonly:!0,value:t.cells(t.getSelectedRowId(),1).getValue()},{type:"input",name:"personil",label:"Jumlah Orang",labelWidth:130,inputWidth:250,value:p,validate:"ValidNumeric"}]}]},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Update"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_clear",offsetLeft:30,value:"Cancel"}]}]);isFormNumeric(a,["personil"]),a.attachEvent("onButtonClick",(function(e){switch(e){case"update":if(!a.validate())return eAlert("Input error!");setDisable(["update","cancel"],a,b);let e=new dataProcessor(Overtime("updatePersonilNeeded"));e.init(a),a.save(),e.attachEvent("onAfterUpdate",(function(e,l,r,i){let n=i.getAttribute("message");switch(l){case"updated":sAlert(n),setEnable(["update","cancel"],a,b),t.cells(t.getSelectedRowId(),5).setValue(a.getItemValue("personil")+" Orang"),closeWindow("change_personil");break;case"error":eaAlert(n),setEnable(["update","cancel"],a,b)}}));break;case"cancel":closeWindow("change_personil")}}));break;case"hour_revision":if(!t.getSelectedRowId())return eAlert("Pilih baris yang akan di revisi!");var n=createWindow("hour_revision_parent_tnp","Revisi Waktu Lembur",510,280);myWins.window("hour_revision_parent_tnp").skipMyCloseEvent=!0;let _=getCurrentTime(t,8,9),g=_.labelStart,v=_.labelEnd;var s=n.attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Jam Lembur",list:[{type:"block",list:[{type:"hidden",name:"id",label:"ID",labelWidth:130,inputWidth:250,value:t.getSelectedRowId()},{type:"combo",name:"start_date",label:g,labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:d.startTimes},{type:"combo",name:"end_date",label:v,labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:d.endTimes}]}]},{type:"newcolumn"},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Update"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Clear"}]}]),c=s.getCombo("start_date"),u=s.getCombo("end_date");let k=d.filterStartTime.indexOf(_.start),T=d.filterEndTime.indexOf(_.end);c.selectOption(k),u.selectOption(T),s.attachEvent("onButtonClick",(function(e){switch(e){case"update":setDisable(["update","cancel"],s,n);let e=new dataProcessor(Overtime("updateOvertimeHour"));e.init(s),s.save(),e.attachEvent("onAfterUpdate",(function(e,t,a,l){let r=l.getAttribute("message");switch(t){case"updated":x(),y(null),sAlert(r),setEnable(["update","cancel"],s,n),closeWindow("hour_revision_parent_tnp");break;case"error":eaAlert("Kesalahan Waktu Lembur",r),setEnable(["update","cancel"],s,n)}}));break;case"cancel":closeWindow("hour_revision_parent_tnp")}}));break;case"production_detail":if(!t.getSelectedRowId())return eAlert("Silahkan pilih lemburan!");{let e="tnp_production_detail_"+t.getSelectedRowId();o.tabs(e)?o.tabs(e).setActive():o.addTab(e,"Detail Lembur Produksi "+t.cells(t.getSelectedRowId(),1).getValue(),null,null,!0,!0);var f=o.tabs(e).attachLayout({pattern:"2E",cells:[{id:"a",text:"Detail Lembur Produksi",height:260},{id:"b",text:"Daftar Personil Lembur"}]});function m(){sumGridToElement(detailGrid,18,"tnp_total_ovt_prod_detail_"+t.getSelectedRowId())}f.cells("b").progressOn(),detailGrid=f.cells("b").attachGrid(),detailGrid.setImagePath("./public/codebase/imgs/"),detailGrid.setHeader("No,Task ID,Nama Karyawan,Sub Unit,Bagian,Disivi,Nama Mesin #1,Nama Mesin #2,Pelayanan Produksi,Tanggal Overtime,Waktu Mulai,Waktu Selesai,Status Hari,Jam Efektif,Jam Istirahat,Jam Ril,Jam Lembur,Premi,Nominal Overtime,Makan,Tugas,Status Overtime,Status Terakhir,Created By,Updated By,Created At,Nik Rejector,EmpID"),detailGrid.attachHeader("#rspan,#text_filter,#text_filter,#select_filter,#select_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter"),detailGrid.setColSorting("int,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str"),detailGrid.setColAlign("center,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left"),detailGrid.setColTypes("rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt"),detailGrid.setInitWidthsP("5,20,20,20,20,20,0,0,15,15,15,15,10,10,10,10,10,10,10,5,25,10,30,15,15,22,0,0"),detailGrid.attachFooter("Total,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#stat_total,#stat_total,#stat_total,#stat_total,,<div id='tnp_total_ovt_prod_detail_"+t.getSelectedRowId()+"'></div>,,,,,,,,,"),detailGrid.enableSmartRendering(!0),detailGrid.attachEvent("onXLE",(function(){f.cells("b").progressOff()})),detailGrid.init(),reqJson(Overtime("getOvertimeDetailView"),"POST",{id:t.getSelectedRowId()},((e,t)=>{"success"===t.status&&(f.cells("a").attachHTMLString(t.template),function(e){f.cells("b").progressOn(),detailGrid.clearAndLoad(Overtime("getOvertimeDetailGrid",{notin_status:"CANCELED,REJECTED",equal_task_id:e}),m)}(t.ref))}))}}}));let g=h.cells("a").attachStatusBar();function v(){var e=t.getRowsNum();g.setText("Total baris: "+e+" ("+a.input_overtime+")")}function x(){h.cells("a").progressOn();t.clearAndLoad(Overtime("getOvertimeGrid",{in_status:"CREATED",notequal_ref:""}),v)}h.cells("a").progressOn(),(t=h.cells("a").attachGrid()).setImagePath("./public/codebase/imgs/"),t.setHeader("No,Task ID,Sub Unit,Bagian,Disivi,Kebutuhan Orang,Status Hari,Tanggal Overtime,Waktu Mulai, Waktu Selesai,Catatan,Makan,Steam,AHU,Compressor,PW,Jemputan,Dust Collector,Mekanik,Listrik,H&N,Status Overtime, Revisi Jam Lembur,Revisi User Approval,Rejection User Approval,Created By,Updated By,Created At"),t.attachHeader("#rspan,#text_filter,#select_filter,#select_filter,#select_filter,#select_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#select_filter,#select_filter,#select_filter,#select_filter,#select_filter,#select_filter,#select_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter"),t.setColSorting("int,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str"),t.setColAlign("center,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left"),t.setColTypes("rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt"),t.setInitWidthsP("5,20,20,20,20,15,15,15,20,20,20,7,7,7,7,7,7,7,7,7,7,10,30,30,30,15,15,25"),t.enableSmartRendering(!0),t.attachEvent("onXLE",(function(){h.cells("a").progressOff()})),t.attachEvent("onRowDblClicked",(function(e,a){y(e),h.cells("b").setText("Proses Personil Lembur : "+t.cells(e,1).getValue()),h.cells("b").expand()})),t.init(),x();var k=h.cells("b").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"add_person",text:"Manage Personil",type:"button",img:"person_16.png"},{id:"delete",text:"Hapus Personil",type:"button",img:"delete.png"},{id:"final",text:"Final Submit",type:"button",img:"update.png"},{id:"hour_revision",text:"Revisi Waktu Lembur",type:"button",img:"clock.png"}]});function y(e){if(e){h.cells("b").progressOn();let a=t.cells(e,1).getValue();formOvtDetailGridTnp.clearAndLoad(Overtime("getOvertimeDetailGrid",{in_status:"CREATED,REJECTED",equal_task_id:a}),T)}else formOvtDetailGridTnp.clearAll(),formOvtDetailGridTnp.callEvent("onGridReconstructed",[]),$("#tnp_total_ovt_input").html("0")}function T(){i=[],sumGridToElement(formOvtDetailGridTnp,18,"tnp_total_ovt_input");for(let e=0;e<formOvtDetailGridTnp.getRowsNum();e++)i.push(formOvtDetailGridTnp.cells2(e,27).getValue())}formOvtDetailGridTnp=h.cells("b").attachGrid(),formOvtDetailGridTnp.setImagePath("./public/codebase/imgs/"),formOvtDetailGridTnp.setHeader("No,Task ID,Nama Karyawan,Sub Unit,Bagian,Disivi,Nama Mesin #1,Nama Mesin #2,Pelayanan Produksi,Tanggal Overtime,Waktu Mulai,Waktu Selesai,Status Hari,Jam Efektif,Jam Istirahat,Jam Ril,Jam Lembur,Premi,Nominal Overtime,Makan,Tugas,Status Overtime,Status Terakhir,Created By,Updated By,Created At,Nik Rejector,EmpID"),formOvtDetailGridTnp.attachHeader("#rspan,#text_filter,#text_filter,#select_filter,#select_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter"),formOvtDetailGridTnp.setColSorting("int,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str"),formOvtDetailGridTnp.setColAlign("center,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left"),formOvtDetailGridTnp.setColTypes("rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt"),formOvtDetailGridTnp.setInitWidthsP("5,20,20,20,20,20,0,0,15,15,15,15,10,10,10,10,10,10,10,5,25,10,30,15,15,22,0,0"),formOvtDetailGridTnp.attachFooter("Total,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#stat_total,#stat_total,#stat_total,#stat_total,,<div id='tnp_total_ovt_input'></div>,,,,,,,,,"),formOvtDetailGridTnp.enableMultiselect(!0),formOvtDetailGridTnp.enableSmartRendering(!0),formOvtDetailGridTnp.attachEvent("onXLE",(function(){h.cells("b").progressOff()})),formOvtDetailGridTnp.init(),k.attachEvent("onClick",(function(e){switch(e){case"add_person":if(!t.getSelectedRowId())return eAlert("Belum ada lemburan yang di pilih!");if(formOvtDetailGridTnp.getRowsNum()>=t.cells(t.getSelectedRowId(),5).getValue().replace(" Orang",""))return eaWarning("Warning Kebutuhan Orang!","Jumlah personil sudah cukup!");var a=createWindow("add_person","Detail Overtime",1100,700);myWins.window("add_person").skipMyCloseEvent=!0;const e=reqJsonResponse(Overtime("getDetailOvertime"),"POST",{id:t.getSelectedRowId()},null);var n=a.attachLayout({pattern:"3U",cells:[{id:"a",text:"Detail",height:260},{id:"b",text:"Klik Pelayanan Untuk Memilih",height:260},{id:"c",text:"Tambah Personil"}]});n.cells("a").attachHTMLString(e.template);let v=getCurrentTime(t,8,9),k=d.filterTime.indexOf(v.start),T=d.filterTime.indexOf(v.end),O=d.filterTime.indexOf(v.start),w=d.filterTime.indexOf(v.end);var s=genWorkTime(d.times,k,T),o=genWorkTime(d.times,O,w),c=n.cells("c").attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Data Lembur",list:[{type:"block",list:[{type:"hidden",name:"overtime_id",label:"Overtime ID",labelWidth:130,inputWidth:250,value:t.getSelectedRowId()},{type:"combo",name:"start_date",label:"Waktu Mulai",labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:s.newStartTime},{type:"combo",name:"end_date",label:"Waktu Selesai",labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:o.newEndTime},{type:"input",name:"requirements",label:"Nama Pelayanan",labelWidth:130,inputWidth:250,readonly:!0}]}]},{type:"newcolumn"},{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Personil Dan Tugas Lembur",list:[{type:"block",list:[{type:"hidden",name:"personil_id",label:"Daftar Personil",labelWidth:130,inputWidth:250,required:!0,readonly:!0},{type:"input",name:"personil_name",label:"Daftar Personil",labelWidth:130,inputWidth:250,required:!0,readonly:!0},{type:"input",name:"notes",label:"Tugas Lembur",labelWidth:130,inputWidth:250,required:!0,rows:3}]}]},{type:"newcolumn"},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"add",className:"button_add",offsetLeft:15,value:"Tambah"},{type:"newcolumn"},{type:"button",name:"clear",className:"button_clear",offsetLeft:30,value:"Clear"}]}]),u=c.getCombo("start_date"),f=c.getCombo("end_date");f.selectOption(o.newEndTime.length-1),c.attachEvent("onChange",(function(e,t){"start_date"!==e&&"end_date"!==e||checkTime(u,f,["add","clear"],c)}));var m=0==e.overtime.steam&&0==e.overtime.ahu&&0==e.overtime.compressor&&0==e.overtime.pw&&0==e.overtime.dust_collector&&0==e.overtime.wfi&&0==e.overtime.hnn;if(m)n.cells("b").attachHTMLString("<div style='width:100%;height:100%;display:flex;flex-direction:center;justify-content:center;align-items:center;font-family:sans-serif'>No Support</div>"),n.cells("b").setText("Lembur Umum"),n.cells("b").collapse(),c.hideItem("requirements");else{n.cells("b").attachMenu({icon_path:"./public/codebase/icons/",items:[{id:"clear",text:"Clear",img:"refresh.png"}]}).attachEvent("onClick",(function(e){switch(e){case"clear":p.clearSelection(),c.setItemValue("requirements","")}})),n.cells("b").progressOn();var p=n.cells("b").attachGrid();p.setImagePath("./public/codebase/imgs/"),p.setHeader("No,Nama Pelayanan,Sub Bagian,Division ID"),p.setColSorting("int,str,str,str"),p.setColAlign("center,left,left,left"),p.setColTypes("rotxt,rotxt,rotxt,rotxt"),p.setInitWidthsP("5,45,50,0"),p.enableMultiselect(!0),p.enableSmartRendering(!0),p.attachEvent("onXLE",(function(){n.cells("b").progressOff()})),p.attachEvent("onRowSelect",(function(e,t){let a=p.getSelectedRowId().split(","),l=[];a.map((e=>l.push(p.cells(e,1).getValue()))),c.setItemValue("requirements",l)})),p.init(),p.clearAndLoad(Overtime("getOvertimeRequirement",{task_id:e.overtime.task_id}))}function b(t=null){var a=createWindow("add_personil_win","Daftar Personil",900,500);myWins.window("add_personil_win").skipMyCloseEvent=!0,a.attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"save",text:"Simpan",type:"button",img:"ok.png"}]}).attachEvent("onClick",(function(e){switch(e){case"save":l=[],r=[];for(let e=0;e<s.getRowsNum();e++){let t=s.getRowId(e);1==s.cells(t,1).getValue()&&(l.push(t),r.push(s.cells(t,2).getValue()))}c.setItemValue("personil_id",l),c.setItemValue("personil_name",r),closeWindow("add_personil_win")}}));var n,s=a.attachGrid();s.setImagePath("./public/codebase/imgs/"),s.setHeader("No,Check,Nama Personil,Sub Unit,Bagian,Sub Bagian"),s.attachHeader("#rspan,#master_checkbox,#text_filter,#select_filter,#select_filter,#select_filter"),s.setColAlign("center,left,left,left,left,left"),s.setColSorting("str,na,str,str,str,str"),s.setColTypes("rotxt,ch,rotxt,rotxt,rotxt,rotxt"),s.setInitWidthsP("5,5,20,20,25,25"),s.enableSmartRendering(!0),s.attachEvent("onXLE",(function(){l.length>0&&l.map((e=>""!==e&&s.cells(e,1).setValue(1))),a.progressOff()})),s.init(),n=t?{in_division_id:t}:{equal_sub_department_id:e.overtime.sub_department_id},s.clearAndLoad(Overtime("getEmployees",n),(function(){i.map((e=>s.cells(e,1).setDisabled(!0)))}))}c.attachEvent("onFocus",(function(e,t){if("personil_name"===e)if(m)b();else if(p.getSelectedRowId()){let e=p.getSelectedRowId().split(","),t=[];e.map((e=>t.push(p.cells(e,3).getValue()))),b(t.join(","))}else b()})),c.attachEvent("onButtonClick",(function(e){switch(e){case"add":if(!c.validate())return eAlert("Input error!");if(formOvtDetailGridTnp.getRowsNum()>=t.cells(t.getSelectedRowId(),5).getValue().replace(" Orang",""))return eaWarning("Warning Kebutuhan Orang!","Jumlah personil sudah cukup!");setDisable(["add","clear"],c,n.cells("c"));let e=new dataProcessor(Overtime("createPersonilOvertime"));e.init(c),c.save(),e.attachEvent("onAfterUpdate",(function(e,a,i,s){let o=s.getAttribute("message");switch(a){case"inserted":sAlert("Berhasil Menambahkan Record <br>"+o),l=[],r=[],p&&p.getSelectedRowId()&&p.clearSelection(),clearAllForm(c,null,null,["start_date","end_date"]),y(t.getSelectedRowId()),setEnable(["add","clear"],c,n.cells("c"));break;case"error":eAlert("Gagal Menambahkan Record <br>"+o),setEnable(["add","clear"],c,n.cells("c"));break;case"invalid":eaAlert("Terjadi Kesalahan",o),setEnable(["add","clear"],c,n.cells("c"))}}));break;case"cancel":clearAllForm(c,null,null,["start_date","end_date"])}}));break;case"delete":if(!formOvtDetailGridTnp.getSelectedRowId())return eAlert("Pilih baris yang akan hapus!");reqAction(formOvtDetailGridTnp,Overtime("personilOvertimeDelete"),1,((e,a)=>{y(t.getSelectedRowId()),a.mSuccess&&sAlert("Sukses Menghapus Record <br>"+a.mSuccess),a.mError&&eAlert("Gagal Menghapus Record <br>"+a.mError)}));break;case"final":if(!t.getSelectedRowId())return eAlert("Pilih baris yang akan di final submit!");if(0===formOvtDetailGridTnp.getRowsNum())return eaAlert("Peringatan","Data personil lembur belum ada!");dhtmlx.modalbox({type:"alert-warning",title:"Konfirmasi Form Lembur",text:"Anda yakin akan melakukan Final Submit, pastikan data lembur sudah sesuai?",buttons:["Ya","Tidak"],callback:function(e){if(0==e){let e=t.cells(t.getSelectedRowId(),1).getValue();reqJson(Overtime("processOvertime"),"POST",{taskId:e},((e,t)=>{e?eAlert("Gagal melakukan final submit!"):("success"===t.status&&(x(),formOvtDetailGridTnp.clearAll(),h.cells("b").setText("Proses Personil"),h.cells("b").collapse(),l=[],r=[],i=[]),sAlert(t.message))}))}}});break;case"hour_revision":if(!formOvtDetailGridTnp.getSelectedRowId())return eAlert("Pilih baris yang akan di revisi!");var _=createWindow("hour_revision_detail_input_tnp","Revisi Waktu Lembur",510,280);myWins.window("hour_revision_detail_input_tnp").skipMyCloseEvent=!0;let S=getCurrentTime(t,8,9),W=d.filterTime.indexOf(S.start),E=d.filterTime.indexOf(S.end),D=d.filterTime.indexOf(S.start),C=d.filterTime.indexOf(S.end);s=genWorkTime(d.times,W,E),o=genWorkTime(d.times,D,C);let R=S.labelStart,A=S.labelEnd;var g=_.attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Jam Lembur",list:[{type:"block",list:[{type:"hidden",name:"id",label:"ID",labelWidth:130,inputWidth:250,value:formOvtDetailGridTnp.getSelectedRowId()},{type:"combo",name:"start_date",label:R,labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:s.newStartTime},{type:"combo",name:"end_date",label:A,labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:o.newEndTime}]}]},{type:"newcolumn"},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Update"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Clear"}]}]);let L=g.getCombo("start_date"),I=g.getCombo("end_date"),P=getCurrentTime(formOvtDetailGridTnp,10,11),G=s.filterStart.indexOf(P.start),N=o.filterEnd.indexOf(P.end);L.selectOption(G),I.selectOption(N),g.attachEvent("onChange",(function(e,t){"start_date"!==e&&"end_date"!==e||checkRevisionTime(d.filterTime,L.getSelectedValue(),I.getSelectedValue(),["update"],g)})),checkRevisionTime(d.filterTime,L.getSelectedValue(),I.getSelectedValue(),["update"],g),g.attachEvent("onButtonClick",(function(e){switch(e){case"update":setDisable(["update","cancel"],g,_);let e=new dataProcessor(Overtime("updateOvertimeDetailHour"));e.init(g),g.save(),e.attachEvent("onAfterUpdate",(function(e,a,l,r){let i=r.getAttribute("message");switch(a){case"updated":y(t.getSelectedRowId()),sAlert(i),setEnable(["update","cancel"],g,_),closeWindow("hour_revision_detail_input_tnp");break;case"error":eaAlert("Kesalahan Waktu Lembur",i),setEnable(["update","cancel"],g,_)}}));break;case"cancel":closeWindow("hour_revision_detail_input_tnp")}}))}}))}

JS;

header('Content-Type: application/javascript');
echo $script;