<?php 
if ((strpos(strtolower($_SERVER['SCRIPT_NAME']), strtolower(basename(__FILE__)))) !== false) { // NOT FALSE if the script"s file name is found in the URL
    header('HTTP/1.0 403 Forbidden');
    die('<h2>Direct access to this page is not allowed.</h2>');
}

$script = <<< "JS"
    		
   function projectManagement(t,a){var e=[],n=[];if(gantt.clearAll(),userLogged.subId!=t)return eaAlert("Akses Error","Anda bukan karyawan bagian "+a);function s(){gantt.clearAll();let a=$("#gantt_division_id").val(),e=$("#gantt_task_id").val(),n=$("#gantt_month").val(),s=$("#gantt_year").val();reqJson(Project("loadData"),"POST",{subId:t,divId:a,taskId:e,month:n,year:s},((t,a)=>{"success"===a.status&&(a.tasks.data.length>0&&gantt.parse({data:a.tasks.data,links:a.tasks.links}),$("#gantt_division_id").html(a.division),$("#gantt_task_id").html(a.tasksList))}))}$("#gantt_sub_name").html(a),projectToolbar.attachEvent("onClick",(function(i){switch(i){case"refresh":s();break;case"share":e=[],n=[];var o=createWindow("share_gantt_win","Bagikan Jadwal Pekerajan",900,500);myWins.window("share_gantt_win").skipMyCloseEvent=!0;var c=o.attachTabbar({tabs:[{id:"a",text:"S.P.E.K.T.A Chat",active:!0},{id:"b",text:"Email"}]}),r=c.cells("a").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"send",text:"Kirim",type:"button",img:"send.png"}]}),l=c.cells("b").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"send",text:"Kirim",type:"button",img:"send.png"}]});r.attachEvent("onClick",(function(n){switch(n){case"send":let n={subId:t,subName:a,divId:$("#gantt_division_id").val(),taskId:$("#gantt_task_id").val(),month:$("#gantt_month").val(),year:$("#gantt_year").val()};r.disableItem("send"),reqJson(Project("shareSpekta"),"POST",{ids:e,tasks:n},((t,a)=>{"success"===a.status?sAlert(a.message):eAlert(a.message),d.uncheckAll(),e=[],r.enableItem("send")}))}})),l.attachEvent("onClick",(function(e){switch(e){case"send":let e={subId:t,subName:a,divId:$("#gantt_division_id").val(),taskId:$("#gantt_task_id").val(),month:$("#gantt_month").val(),year:$("#gantt_year").val()};r.disableItem("send"),reqJson(Project("shareEmail"),"POST",{ids:n,tasks:e},((t,a)=>{"success"===a.status?sAlert(a.message):eAlert(a.message),g.uncheckAll(),n=[],r.enableItem("send")}))}}));let i=c.cells("a").attachStatusBar();c.cells("a").progressOn();var d=c.cells("a").attachGrid();d.setImagePath("./public/codebase/imgs/"),d.setHeader("No,Check,Nama,Email"),d.attachHeader("#rspan,#rspan,#text_filter,#text_filter"),d.setColAlign("center,left,left,left"),d.setColTypes("rotxt,ch,rotxt,rotxt"),d.setColSorting("int,na,str,str"),d.setInitWidthsP("5,5,45,45"),d.enableSmartRendering(!0),d.attachEvent("onXLE",(function(){c.cells("a").progressOff()})),d.attachEvent("onCheckbox",(function(t,a,n){n?e.push(t):e.splice(e.indexOf(t),1)})),d.init(),d.clearAndLoad(Project("getSpektaChatUser"),(function(){i.setText("Total baris: "+d.getRowsNum())}));let h=c.cells("b").attachStatusBar();c.cells("b").progressOn();var g=c.cells("b").attachGrid();g.setImagePath("./public/codebase/imgs/"),g.setHeader("No,Check,Nama,Email"),g.attachHeader("#rspan,#rspan,#text_filter,#text_filter"),g.setColAlign("center,left,left,left"),g.setColTypes("rotxt,ch,rotxt,rotxt"),g.setColSorting("int,na,str,str"),g.setInitWidthsP("5,5,45,45"),g.enableSmartRendering(!0),g.attachEvent("onXLE",(function(){c.cells("b").progressOff()})),g.attachEvent("onCheckbox",(function(t,a,e){e?n.push(t):n.splice(n.indexOf(t),1)})),g.init(),g.clearAndLoad(Project("getEmpEmail"),(function(){h.setText("Total baris: "+g.getRowsNum())}))}})),s(),$("#gantt_division_id").on("change",(function(){s()})),$("#gantt_task_id").on("change",(function(){s()})),$("#gantt_month").on("change",(function(){s()})),$("#gantt_year").on("change",(function(){s()}));var i=new gantt.dataProcessor(Project("lightboxAction"));i.init(gantt),i.setTransactionMode("JSON"),gantt.attachEvent("onLightboxSave",(function(t,a,e){return i.sendData,!0})),gantt.attachEvent("onAfterTaskUpdate",(function(t,a){i.sendData}))}
    
JS;

header('Content-Type: application/javascript');
echo $script;
