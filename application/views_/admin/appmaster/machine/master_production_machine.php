<?php 
if ((strpos(strtolower($_SERVER['SCRIPT_NAME']), strtolower(basename(__FILE__)))) !== false) { // NOT FALSE if the script"s file name is found in the URL
    header('HTTP/1.0 403 Forbidden');
    die('<h2>Direct access to this page is not allowed.</h2>');
}

$script = <<< "JS"
	
	function showPMachine(){var e,t,a,i={building_id:{url:AppMaster("getBuilding"),reload:!0},room_id:{url:AppMaster("getBuildingRoom"),reload:!1},department_id:{url:Emp("getDepartment"),reload:!0},sub_department_id:{url:Emp("getSubDepartment"),reload:!1},division_id:{url:Emp("getDivision"),reload:!1}},l=mainTab.cells("master_production_machine").attachLayout({pattern:"2U",cells:[{id:"a",header:!1},{id:"b",text:"Form Mesin Produksi",header:!0,collapse:!0}]}),n=mainTab.cells("master_production_machine").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"refresh",text:"Refresh",type:"button",img:"refresh.png"},{id:"add",text:"Tambah",type:"button",img:"add.png"},{id:"delete",text:"Hapus",type:"button",img:"delete.png"},{id:"edit",text:"Ubah",type:"button",img:"edit.png",img_disabled:"edit_disabled.png"},{id:"export",text:"Export To Excel",type:"button",img:"excel.png"},{id:"searchtext",text:"Cari : ",type:"text"},{id:"search",text:"",type:"buttonInput",width:150}]});"admin"!==userLogged.role&&n.disableItem("delete");var d=mainTab.cells("master_production_machine").attachMenu({icon_path:"./public/codebase/icons/",items:[{id:"update",text:"Update Grid",img:"update.png"}]}),r=l.cells("a").attachStatusBar();function o(){let e=s.getRowsNum();r.setText("Total baris: "+e)}var s=l.cells("a").attachGrid();function c(){machineGridDP=new dataProcessor(AppMaster("updateProdMachineBatch")),machineGridDP.setTransactionMode("POST",!0),machineGridDP.setUpdateMode("Off"),machineGridDP.init(s)}function p(){l.cells("a").progressOn(),s.clearAndLoad(AppMaster("prodMachineGrid",{search:n.getValue("search")}),o)}async function m(e,i,n=null){if(e.validate()){var d=i.filename.split(".").pop();if("png"==d||"jpg"==d||"jpeg"==d)if(i.size>1e6)t=!0,eAlert("Tidak boleh melebihi 1 MB!");else if(a>0)eAlert("Maksimal 1 file"),t=!0;else{const i={id:n,name:e.getItemValue("name"),building_id:e.getItemValue("building_id"),room_id:e.getItemValue("room_id"),department_id:e.getItemValue("department_id"),sub_department_id:e.getItemValue("sub_department_id"),division_id:e.getItemValue("division_id")},d=await reqJsonResponse(AppMaster("checkBeforeAddFile3"),"POST",i);if(d){if("success"===d.status)return a++,!0;"deleted"===d.status?(t=!1,a=0,l.cells("b").collapse(),l.cells("b").showView("tambah_mesin_produksi")):(eAlert(d.message),t=!0)}}else eAlert("Hanya png, jpg & jpeg saja yang bisa diupload!"),t=!0}else eAlert("Input error!")}s.setHeader("No,Nama Mesin,Gedung,Ruangan,Sub Unit,Bagian,Sub Bagian,Dimensi,Created By,Updated By,DiBuat"),s.attachHeader("#rspan,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter"),s.setColSorting("str,str,str,str,str,str,str,str,str,str,str"),s.setColTypes("rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt"),s.setColAlign("center,left,left,left,left,left,left,left,left,left,left"),s.setInitWidthsP("5,25,20,20,15,20,20,15,15,15,25"),s.enableSmartRendering(!0),s.enableMultiselect(!0),s.setEditable(!0),s.attachEvent("onXLE",(function(){l.cells("a").progressOff()})),s.init(),c(),p(),n.attachEvent("onClick",(function(a){switch(a){case"refresh":n.setValue("search",""),p();break;case"add":!function(){l.cells("b").expand(),l.cells("b").showView("tambah_mesin_produksi"),addMachineForm=l.cells("b").attachForm([{type:"fieldset",offsetTop:30,offsetLeft:30,label:"Tambah Mesin Produksi",list:[{type:"input",name:"name",label:"Nama Mesin",labelWidth:130,inputWidth:250,required:!0},{type:"combo",name:"building_id",label:"Nama Gedung",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"combo",name:"room_id",label:"Nama Ruangan",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"combo",name:"department_id",label:"Sub Unit",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"combo",name:"sub_department_id",label:"Bagian",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"combo",name:"division_id",label:"Sub Bagian",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"input",name:"dimension",label:"Dimensi",labelWidth:130,inputWidth:250},{type:"hidden",name:"filename",label:"Filename",readonly:!0},{type:"upload",name:"file_uploader",inputWidth:420,url:AppMaster("fileUpload",{save:!1,folder:"production_machines"}),swfPath:"./public/codebase/ext/uploader.swf",swfUrl:AppMaster("fileUpload")},{type:"block",offsetTop:30,list:[{type:"button",name:"add",className:"button_add",offsetLeft:15,value:"Tambah"},{type:"newcolumn"},{type:"button",name:"clear",className:"button_clear",offsetLeft:30,value:"Clear"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Cancel"}]}]}]);var e=addMachineForm.getCombo("building_id");e.load(AppMaster("getBuilding")),e.attachEvent("onChange",(function(e,t){clearComboReload(addMachineForm,"room_id",AppMaster("getBuildingRoom",{buildId:e}))}));var a=addMachineForm.getCombo("department_id"),n=addMachineForm.getCombo("sub_department_id");function d(){if(!addMachineForm.validate())return eAlert("Input error!");setDisable(["add","clear"],addMachineForm,l.cells("b"));let e=new dataProcessor(AppMaster("prodMachineForm"));e.init(addMachineForm),addMachineForm.save(),e.attachEvent("onAfterUpdate",(function(e,t,a,n){let d=n.getAttribute("message");switch(t){case"inserted":sAlert("Berhasil Menambahkan Record <br>"+d),p(),clearAllForm(addMachineForm,i),clearUploader(addMachineForm,"file_uploader"),setEnable(["add","clear"],addMachineForm,l.cells("b"));break;case"error":eAlert("Gagal Menambahkan Record <br>"+d),setEnable(["add","clear"],addMachineForm,l.cells("b"))}}))}a.load(Emp("getDepartment")),a.attachEvent("onChange",(function(e,t){clearComboReload(addMachineForm,"sub_department_id",Emp("getSubDepartment",{deptId:e}))})),n.attachEvent("onChange",(function(e,t){clearComboReload(addMachineForm,"division_id",Emp("getDivision",{subDeptId:e}))})),addMachineForm.attachEvent("onBeforeFileAdd",(async function(e,t){m(addMachineForm,{filename:e,size:t})})),addMachineForm.attachEvent("onBeforeFileUpload",(function(e,a,i){if(!t)return!0;clearUploader(addMachineForm,"file_uploader"),eAlert("File error silahkan upload file sesuai ketentuan!"),t=!1})),addMachineForm.attachEvent("onButtonClick",(function(e){switch(e){case"add":const e=addMachineForm.getUploader("file_uploader");-1===e.getStatus()?t?(e.clear(),eAlert("File error silahkan upload file sesuai ketentuan!"),t=!1):e.upload():d();break;case"clear":clearAllForm(addMachineForm,i);break;case"cancel":l.cells("b").collapse()}})),addMachineForm.attachEvent("onUploadFile",(function(e,t){addMachineForm.setItemValue("filename",t),d()}))}();break;case"delete":reqAction(s,AppMaster("prodMachineDelete"),1,((e,t)=>{p(),t.mSuccess&&sAlert("Sukses Menghapus Record <br>"+t.mSuccess),t.mError&&eAlert("Gagal Menghapus Record <br>"+t.mError)}));break;case"edit":!function(){if(!s.getSelectedRowId())return eAlert("Pilih baris yang akan diubah!");l.cells("b").expand(),l.cells("b").showView("edit_mesin_produksi"),e=l.cells("b").attachForm([{type:"fieldset",offsetTop:30,offsetLeft:30,label:"Edit Ruang Meeting",list:[{type:"hidden",name:"id",label:"ID",readonly:!0},{type:"input",name:"name",label:"Nama Mesin",labelWidth:130,inputWidth:250,required:!0},{type:"combo",name:"building_id",label:"Nama Gedung",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"combo",name:"room_id",label:"Nama Ruangan",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"combo",name:"department_id",label:"Sub Unit",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"combo",name:"sub_department_id",label:"Bagian",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"combo",name:"division_id",label:"Sub Bagian",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"input",name:"dimension",label:"Dimensi",labelWidth:130,inputWidth:250},{type:"hidden",name:"filename",label:"Filename",readonly:!0},{type:"upload",name:"file_uploader",inputWidth:420,url:AppMaster("fileUpload",{save:!1,folder:"production_machines"}),swfPath:"./public/codebase/ext/uploader.swf",swfUrl:AppMaster("fileUpload"),autoStart:!0},{type:"block",offsetTop:30,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Simpan"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Cancel"}]}]},{type:"fieldset",offsetTop:30,offsetLeft:30,label:"Foto Mesin Produksi",list:[{type:"container",name:"file_display",label:"<img src='./public/img/no-image.png' height='120' width='120'>"}]}]);const a=t=>{0===t.length?e.setItemLabel("file_display","<img src='./public/img/no-image.png' height='120' width='120'>"):t.map((t=>{if(""===t)e.setItemLabel("file_display","<img src='./public/img/no-image.png' height='120' width='120'>");else{var a="<img src='./assets/images/production_machines/"+t+"' height='120' width='120'>";e.setItemLabel("file_display",a)}}))};var i=e.getCombo("building_id"),n=e.getCombo("room_id"),d=e.getCombo("department_id"),r=e.getCombo("sub_department_id"),o=e.getCombo("division_id");function c(){i.load(AppMaster("getBuilding",{select:e.getItemValue("building_id")})),n.load(AppMaster("getBuildingRoom",{buildId:e.getItemValue("building_id"),select:e.getItemValue("room_id")})),d.load(Emp("getDepartment",{select:e.getItemValue("department_id")})),r.load(Emp("getSubDepartment",{deptId:e.getItemValue("department_id"),select:e.getItemValue("sub_department_id")})),o.load(Emp("getDivision",{subDeptId:e.getItemValue("sub_department_id"),select:e.getItemValue("division_id")})),i.attachEvent("onChange",(function(t,a){clearComboReload(e,"room_id",AppMaster("getBuildingRoom",{buildId:t,select:e.getItemValue("room_id")}))})),d.attachEvent("onChange",(function(t,a){clearComboReload(e,"sub_department_id",Emp("getSubDepartment",{deptId:t,select:e.getItemValue("sub_department_id")}))})),r.attachEvent("onChange",(function(t,a){clearComboReload(e,"division_id",Emp("getDivision",{subDeptId:t,select:e.getItemValue("division_id")}))}))}fetchFormData(AppMaster("prodMachineForm",{id:s.getSelectedRowId()}),e,["filename"],a,c),e.attachEvent("onBeforeFileAdd",(async function(t,a){m(e,{filename:t,size:a},e.getItemValue("id"))})),e.attachEvent("onBeforeFileUpload",(function(a,i,l){if(!t)return!0;clearUploader(e,"file_uploader"),eAlert("File error silahkan upload file sesuai ketentuan!"),t=!1})),e.attachEvent("onUploadFile",(function(t,a){reqJson(AppMaster("updateAfterUpload"),"POST",{id:e.getItemValue("id"),oldFile:e.getItemValue("filename"),filename:a,folder:"kf_maintenance.production_machines"},((t,i)=>{"success"===i.status?(e.setItemValue("filename",a),clearUploader(e,"file_uploader"),e.setItemLabel("file_display","<img src='./assets/images/production_machines/"+a+"' height='120' width='120'>"),sAlert(i.message)):eAlert(i.message)}))})),e.attachEvent("onButtonClick",(function(t){switch(t){case"update":setDisable(["update","cancel"],e,l.cells("b"));let t=new dataProcessor(AppMaster("prodMachineForm"));t.init(e),e.save(),t.attachEvent("onAfterUpdate",(function(t,a,i,n){let d=n.getAttribute("message");switch(a){case"updated":sAlert("Berhasil Mengubah Record <br>"+d),p(),l.cells("b").progressOff(),l.cells("b").showView("tambah_mesin_produksi"),l.cells("b").collapse();break;case"error":eAlert("Gagal Mengubah Record <br>"+d),setEnable(["update","cancel"],e,l.cells("b"))}}));break;case"cancel":l.cells("b").collapse(),l.cells("b").showView("tambah_mesin_produksi")}}))}();break;case"export":s.toExcel("./public/codebase/grid-to-excel-php/generate.php"),sAlert("Export Data Dimulai")}})),n.attachEvent("onEnter",(function(e){switch(e){case"search":p(),s.attachEvent("onGridReconstructed",o)}})),d.attachEvent("onClick",(function(e){switch(e){case"update":if(!s.getChangedRows())return eAlert("Belum ada row yang di edit!");d.setItemDisabled("update"),l.cells("a").progressOn(),machineGridDP.sendData(),machineGridDP.attachEvent("onAfterUpdate",(function(e,t,a,i){let n=i.getAttribute("message");switch(t){case"updated":sAlert(n),p(),d.setItemEnabled("update"),l.cells("a").progressOff(),c();break;case"error":eAlert(n),d.setItemEnabled("update"),l.cells("a").progressOff()}}))}}))}

JS;

header('Content-Type: application/javascript');
echo $script;
