<?php 
if ((strpos(strtolower($_SERVER['SCRIPT_NAME']), strtolower(basename(__FILE__)))) !== false) { // NOT FALSE if the script"s file name is found in the URL
    header('HTTP/1.0 403 Forbidden');
    die('<h2>Direct access to this page is not allowed.</h2>');
}

$script = <<< "JS"
	
	function showMasterPIC(){var e,t,a=[],i={department_id:{url:Emp("getDepartment"),reload:!0},sub_department_id:{reload:!1}},l=mainTab.cells("master_pic").attachLayout({pattern:"2U",cells:[{id:"a",header:!1},{id:"b",text:"Form PIC",header:!0,collapse:!0}]}),n=mainTab.cells("master_pic").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"refresh",text:"Refresh",type:"button",img:"refresh.png"},{id:"add",text:"Tambah",type:"button",img:"add.png"},{id:"edit",text:"Ubah",type:"button",img:"edit.png",img_disabled:"edit_disabled.png"},{id:"searchtext",text:"Cari : ",type:"text"},{id:"search",text:"",type:"buttonInput",width:150}]}),r=l.cells("a").attachStatusBar();function s(){let e=c.getRowsNum();r.setText("Total baris: "+e)}var c=l.cells("a").attachGrid();function o(){l.cells("a").progressOn(),c.clearAndLoad(AppMaster2("picGrid",{search:n.getValue("search")}),s)}function d(e){if(""===e.getItemValue("sub_department_id"))return eAlert("Bagian belum di pilih!");var t=createWindow("master_pic_window","Karyawan",900,400);myWins.window("master_pic_window").skipMyCloseEvent=!0,t.attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"save",text:"Simpan",type:"button",img:"ok.png"}]}).attachEvent("onClick",(function(t){switch(t){case"save":a=[];for(let e=0;e<wPicGrid.getRowsNum();e++){let t=wPicGrid.getRowId(e);1==wPicGrid.cells(t,1).getValue()&&a.push(t)}e.setItemValue("pic_emails",a),closeWindow("master_pic_window")}}));let i=t.attachStatusBar();t.progressOn(),wPicGrid=t.attachGrid(),wPicGrid.setImagePath("./public/codebase/imgs/"),wPicGrid.setHeader("No,Check,Nama Karyawan,Bagian,Jabatan,Email"),wPicGrid.attachHeader("#rspan,#master_checkbox,#text_filter,#select_filter,#select_filter,#text_filter"),wPicGrid.setColSorting("int,na,str,str,str,str"),wPicGrid.setColAlign("center,left,left,left,left,left"),wPicGrid.setColTypes("rotxt,ch,rotxt,rotxt,rotxt,rotxt"),wPicGrid.setInitWidthsP("5,5,20,25,20,25"),wPicGrid.enableMultiselect(!0),wPicGrid.enableSmartRendering(!0),wPicGrid.attachEvent("onXLE",(function(){t.progressOff()})),wPicGrid.init(),wPicGrid.attachEvent("onCheckbox",(function(e,t,i){i?a.push(e):a.splice(a.indexOf(e),1)})),wPicGrid.clearAndLoad(RoomRev("getEmployees",{equal_sub_department_id:e.getItemValue("sub_department_id"),equal_status:"ACTIVE"}),(function(){var e=c.getRowsNum();i.setText("Total baris: "+e),a.length>0&&a.map((e=>{wPicGrid.doesRowExist(e)&&wPicGrid.cells(e,1).setValue(1)}))}))}c.setHeader("No,Kode,Nama Kegiatan,Sub Unit,Bagian,Created By,Updated By,DiBuat"),c.attachHeader("#rspan,#text_filter,#text_filter,#select_filter,#select_filter,#text_filter,#text_filter,#text_filter"),c.setColSorting("str,str,str,str,str,str,str,str"),c.setColTypes("rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt"),c.setColAlign("center,left,left,left,left,left,left,left"),c.setInitWidthsP("5,20,20,20,20,15,15,25"),c.enableSmartRendering(!0),c.enableMultiselect(!0),c.attachEvent("onXLE",(function(){l.cells("a").progressOff()})),c.init(),o(),n.attachEvent("onClick",(function(r){switch(r){case"refresh":n.setValue("search",""),o();break;case"add":!function(){a=[],l.cells("b").expand(),l.cells("b").showView("tambah_pic");var t=(e=l.cells("b").attachForm([{type:"fieldset",offsetTop:30,offsetLeft:30,label:"Tambah PIC",list:[{type:"combo",name:"code",label:"Kode",labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:[{value:"vehicles",text:"Reservasi Kendaraan Dinas"},{value:"meeting_rooms",text:"Reservasi Ruang Meeting"},{value:"overtime",text:"Pembuatan Lemburan"}]},{type:"input",name:"name",label:"Nama Kegiatan",labelWidth:130,inputWidth:250,required:!0},{type:"combo",name:"department_id",label:"Sub Unit",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"combo",name:"sub_department_id",label:"Bagian",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"input",name:"pic_emails",label:"PIC Email",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"block",offsetTop:30,list:[{type:"button",name:"add",className:"button_add",offsetLeft:15,value:"Tambah"},{type:"newcolumn"},{type:"button",name:"clear",className:"button_clear",offsetLeft:30,value:"Clear"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Cancel"}]}]}])).getCombo("department_id");t.load(Emp("getDepartment")),t.attachEvent("onChange",(function(t,a){clearComboReload(e,"sub_department_id",Emp("getSubDepartment",{deptId:t}))})),e.attachEvent("onFocus",(function(t,a){"pic_emails"===t&&d(e)})),e.attachEvent("onButtonClick",(function(t){switch(t){case"add":if(!e.validate())return eAlert("Input error!");setDisable(["add","clear"],e,l.cells("b"));let t=new dataProcessor(AppMaster2("picForm"));t.init(e),e.save(),t.attachEvent("onAfterUpdate",(function(t,n,r,s){let c=s.getAttribute("message");switch(n){case"inserted":sAlert("Berhasil Menambahkan Record <br>"+c),o(),clearAllForm(e,i),setEnable(["add","clear"],e,l.cells("b")),a=[];break;case"error":eAlert("Gagal Menambahkan Record <br>"+c),setEnable(["add","clear"],e,l.cells("b"))}}));break;case"clear":clearAllForm(e,i);break;case"cancel":o(),l.cells("b").collapse()}}))}();break;case"edit":!function(){if(!c.getSelectedRowId())return eAlert("Pilih baris yang akan diubah!");l.cells("b").expand(),l.cells("b").showView("edit_pic");var e=(t=l.cells("b").attachForm([{type:"fieldset",offsetTop:30,offsetLeft:30,label:"Ubah PIC",list:[{type:"hidden",name:"id",label:"ID",readonly:!0},{type:"hidden",name:"code",label:"Kode",labelWidth:130,inputWidth:250,required:!0},{type:"input",name:"name",label:"Nama Kegiatan",labelWidth:130,inputWidth:250,required:!0},{type:"combo",name:"department_id",label:"Sub Unit",readonly:!0,required:!0,labelWidth:130,inputWidth:250,connector:i.department_id},{type:"combo",name:"sub_department_id",label:"Bagian",readonly:!0,required:!0,labelWidth:130,inputWidth:250,connector:i.sub_department_id},{type:"input",name:"pic_emails",label:"PIC Email",readonly:!0,required:!0,labelWidth:130,inputWidth:250},{type:"block",offsetTop:30,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Simpan"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Cancel"}]}]}])).getCombo("department_id"),n=t.getCombo("sub_department_id");function r(){e.load(Emp("getDepartment",{select:t.getItemValue("department_id")})),n.load(Emp("getSubDepartment",{deptId:t.getItemValue("department_id"),select:t.getItemValue("sub_department_id")})),e.attachEvent("onChange",(function(e,a){clearComboReload(t,"sub_department_id",Emp("getSubDepartment",{deptId:e}))})),a=t.getItemValue("pic_emails").split(",")}fetchFormData(AppMaster2("picForm",{id:c.getSelectedRowId()}),t,null,null,r),t.attachEvent("onFocus",(function(e,a){"pic_emails"===e&&d(t)})),t.attachEvent("onButtonClick",(function(e){switch(e){case"update":if(!t.validate())return eAlert("Input error!");setDisable(["update","cancel"],t,l.cells("b"));let e=new dataProcessor(AppMaster2("picForm"));e.init(t),t.save(),e.attachEvent("onAfterUpdate",(function(e,i,n,r){let s=r.getAttribute("message");switch(i){case"updated":sAlert("Berhasil Mengubah Record <br>"+s),o(),l.cells("b").progressOff(),l.cells("b").showView("tambah_pic"),l.cells("b").collapse(),a=[];break;case"error":eAlert("Gagal Mengubah Record<br>"+s),setEnable(["update","cancel"],t,l.cells("b"))}}));break;case"cancel":l.cells("b").collapse(),l.cells("b").showView("tambah_pic")}}))}()}})),n.attachEvent("onEnter",(function(e){switch(e){case"search":o(),c.attachEvent("onGridReconstructed",s)}}))}

JS;

header('Content-Type: application/javascript');
echo $script;