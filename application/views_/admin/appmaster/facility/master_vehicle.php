<?php 
if ((strpos(strtolower($_SERVER['SCRIPT_NAME']), strtolower(basename(__FILE__)))) !== false) { // NOT FALSE if the script"s file name is found in the URL
    header('HTTP/1.0 403 Forbidden');
    die('<h2>Direct access to this page is not allowed.</h2>');
}

$script = <<< "JS"
	
	function showVehicle(){var e,t,a,l,i=mainTab.cells("master_vehicle").attachLayout({pattern:"2U",cells:[{id:"a",header:!1},{id:"b",text:"Form Kendaraan Inventaris",header:!0,collapse:!0}]}),n=mainTab.cells("master_vehicle").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"refresh",text:"Refresh",type:"button",img:"refresh.png"},{id:"add",text:"Tambah",type:"button",img:"add.png"},{id:"delete",text:"Hapus",type:"button",img:"delete.png"},{id:"edit",text:"Ubah",type:"button",img:"edit.png",img_disabled:"edit_disabled.png"},{id:"searchtext",text:"Cari : ",type:"text"},{id:"search",text:"",type:"buttonInput",width:150}]});"admin"!==userLogged.role&&n.disableItem("delete");var r=mainTab.cells("master_vehicle").attachMenu({icon_path:"./public/codebase/icons/",items:[{id:"update",text:"Update Grid",img:"update.png"}]}),s=i.cells("a").attachStatusBar();function d(){let e=o.getRowsNum();s.setText("Total baris: "+e)}var o=i.cells("a").attachGrid();function c(){vehicleGridDP=new dataProcessor(AppMaster("updateVehicleBatch")),vehicleGridDP.setTransactionMode("POST",!0),vehicleGridDP.setUpdateMode("Off"),vehicleGridDP.init(o)}function p(){i.cells("a").progressOn(),o.clearAndLoad(AppMaster("vehicleGrid",{search:n.getValue("search")}),d)}async function u(e,t,n=null){if(e.validate()){var r=t.filename.split(".").pop();if("png"==r||"jpg"==r||"jpeg"==r)if(t.size>1e6)a=!0,eAlert("Tidak boleh melebihi 1 MB!");else if(l>0)eAlert("Maksimal 1 file"),a=!0;else{const t=n?{id:n,police_no:e.getItemValue("police_no")}:{police_no:e.getItemValue("police_no")},r=await reqJsonResponse(AppMaster("checkBeforeAddFile2"),"POST",t);if(r){if("success"===r.status)return l++,!0;"deleted"===r.status?(a=!1,l=0,i.cells("b").collapse(),i.cells("b").showView("tambah_kendaraan")):(eAlert(r.message),a=!0)}}else eAlert("Hanya png, jpg & jpeg saja yang bisa diupload!"),a=!0}else eAlert("Input error!")}o.setHeader("No,Nama Kendaraan,Merk/Brand,Tipe,Kode Warna,Colopicker,Nomor Polisi,Kapasitas Penumpang (Orang),Nomor BPKB,Nomor STNK,Nomor Mesin,Kapasitas Mesin (CC),Kilometer,Tanggal Service,Created By,Updated By,DiBuat"),o.attachHeader("#rspan,#text_filter,#text_filter,#text_filter,#rspan,#rspan,#text_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter"),o.setColSorting("str,str,str,str,str,str,str,str,str,str,str,str,str,date,str,str,str"),o.setColTypes("rotxt,rotxt,edtxt,edtxt,edtxt,cp,rotxt,edtxt,rotxt,rotxt,rotxt,edtxt,edtxt,dhxCalendar,rotxt,rotxt,rotxt"),o.setColAlign("center,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left"),o.setInitWidthsP("5,15,15,15,10,10,15,20,15,15,20,15,15,15,15,15,25"),o.enableSmartRendering(!0),o.enableMultiselect(!0),o.setEditable(!0),o.attachEvent("onEditCell",(function(e,t,a){2===e?4===a?o.cells(t,5).setValue(o.cells(t,4).getValue()):5===a&&o.cells(t,4).setValue(o.cells(t,5).getValue()):1!==e||7!==a&&11!==a&&12!==a||(this.editor.obj.onkeypress=function(e){return-1!="0123456789".indexOf(String.fromCharCode((e||event).keyCode))});return!0})),o.attachEvent("onXLE",(function(){i.cells("a").progressOff()})),o.init(),c(),p(),n.attachEvent("onClick",(function(l){switch(l){case"refresh":n.setValue("search",""),p();break;case"add":!function(){function t(){if(!e.validate())return eAlert("Input error!");setDisable(["add","clear"],e,i.cells("b"));let t=new dataProcessor(AppMaster("vehicleForm"));t.init(e),e.save(),t.attachEvent("onAfterUpdate",(function(t,a,l,n){let r=n.getAttribute("message");switch(a){case"inserted":sAlert("Berhasil Menambahkan Record <br>"+r),p(),clearAllForm(e),clearUploader(e,"file_uploader"),setEnable(["add","clear"],e,i.cells("b"));break;case"error":eAlert("Gagal Menambahkan Record <br>"+r),setEnable(["add","clear"],e,i.cells("b"))}}))}i.cells("b").expand(),i.cells("b").showView("tambah_kendaraan"),e=i.cells("b").attachForm([{type:"fieldset",offsetTop:30,offsetLeft:30,label:"Tambah Kendaraan",list:[{type:"input",name:"name",label:"Nama Kendaraan",labelWidth:130,inputWidth:250,required:!0},{type:"input",name:"brand",label:"Brand/Merk",labelWidth:130,inputWidth:250,required:!0},{type:"input",name:"type",label:"Tipe",labelWidth:130,inputWidth:250,required:!0},{type:"input",name:"police_no",label:"Nomor Polisi",labelWidth:130,inputWidth:250,required:!0},{type:"input",name:"bpkb_no",label:"Nomor BPKB",labelWidth:130,inputWidth:250},{type:"input",name:"stnk_no",label:"Nomor STNK",labelWidth:130,inputWidth:250},{type:"input",name:"machine_no",label:"Nomor Mesin",labelWidth:130,inputWidth:250},{type:"input",name:"machine_capacity",label:"Kapasitas Mesin",labelWidth:130,inputWidth:250,validate:"ValidNumeric"},{type:"input",name:"passenger_capacity",label:"Kapasitas Penumpang",labelWidth:130,inputWidth:250,required:!0,validate:"ValidNumeric"},{type:"input",name:"last_km",label:"Kilometer Akhir",labelWidth:130,inputWidth:250,validate:"ValidNumeric"},{type:"calendar",name:"last_service_date",label:"Tanggal Terakhir Service",labelWidth:130,inputWidth:250},{type:"colorpicker",name:"color",label:"Indikasi Warna",labelWidth:130,inputWidth:250,readonly:!0,required:!0},{type:"hidden",name:"filename",label:"Filename",readonly:!0},{type:"upload",name:"file_uploader",inputWidth:420,url:AppMaster("fileUpload",{save:!1,folder:"vehicles"}),swfPath:"./public/codebase/ext/uploader.swf",swfUrl:AppMaster("fileUpload")},{type:"block",offsetTop:30,list:[{type:"button",name:"add",className:"button_add",offsetLeft:15,value:"Tambah"},{type:"newcolumn"},{type:"button",name:"clear",className:"button_clear",offsetLeft:30,value:"Clear"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Cancel"}]}]}]),isFormNumeric(e,["machine_capacity","passenger_capacity","last_km"]),e.attachEvent("onBeforeFileAdd",(async function(t,a){u(e,{filename:t,size:a})})),e.attachEvent("onBeforeFileUpload",(function(t,l,i){if(!a)return!0;clearUploader(e,"file_uploader"),eAlert("File error silahkan upload file sesuai ketentuan!"),a=!1})),e.attachEvent("onButtonClick",(function(l){switch(l){case"add":const l=e.getUploader("file_uploader");-1===l.getStatus()?a?(l.clear(),eAlert("File error silahkan upload file sesuai ketentuan!"),a=!1):l.upload():t();break;case"clear":clearAllForm(e);break;case"cancel":i.cells("b").collapse()}})),e.attachEvent("onUploadFile",(function(a,l){e.setItemValue("filename",l),t()}))}();break;case"delete":reqAction(o,AppMaster("vehicleDelete"),1,((e,t)=>{p(),t.mSuccess&&sAlert("Sukses Menghapus Record <br>"+t.mSuccess),t.mError&&eAlert("Gagal Menghapus Record <br>"+t.mError)}));break;case"edit":!function(){if(!o.getSelectedRowId())return eAlert("Pilih baris yang akan diubah!");i.cells("b").expand(),i.cells("b").showView("edit_ruang_meeting"),t=i.cells("b").attachForm([{type:"fieldset",offsetTop:30,offsetLeft:30,label:"Edit Ruang Meeting",list:[{type:"hidden",name:"id",label:"ID",readonly:!0},{type:"input",name:"name",label:"Nama Kendaraan",labelWidth:130,inputWidth:250,required:!0},{type:"input",name:"brand",label:"Brand/Merk",labelWidth:130,inputWidth:250,required:!0},{type:"input",name:"type",label:"Tipe",labelWidth:130,inputWidth:250,required:!0},{type:"input",name:"police_no",label:"Nomor Polisi",labelWidth:130,inputWidth:250,required:!0},{type:"input",name:"bpkb_no",label:"Nomor BPKB",labelWidth:130,inputWidth:250},{type:"input",name:"stnk_no",label:"Nomor STNK",labelWidth:130,inputWidth:250},{type:"input",name:"machine_no",label:"Nomor Mesin",labelWidth:130,inputWidth:250},{type:"input",name:"machine_capacity",label:"Kapasitas Mesin",labelWidth:130,inputWidth:250,validate:"ValidNumeric"},{type:"input",name:"passenger_capacity",label:"Kapasitas Penumpang",labelWidth:130,inputWidth:250,required:!0,validate:"ValidNumeric"},{type:"input",name:"last_km",label:"Kilometer Akhir",labelWidth:130,inputWidth:250,validate:"ValidNumeric"},{type:"calendar",name:"last_service_date",label:"Tanggal Terakhir Service",labelWidth:130,inputWidth:250},{type:"colorpicker",name:"color",label:"Indikasi Warna",labelWidth:130,inputWidth:250,readonly:!0,required:!0},{type:"hidden",name:"filename",label:"Filename",readonly:!0},{type:"upload",name:"file_uploader",inputWidth:420,url:AppMaster("fileUpload",{save:!1,folder:"vehicles"}),swfPath:"./public/codebase/ext/uploader.swf",swfUrl:AppMaster("fileUpload"),autoStart:!0},{type:"block",offsetTop:30,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Simpan"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Cancel"}]}]},{type:"fieldset",offsetTop:30,offsetLeft:30,label:"Foto Kedaraan",list:[{type:"container",name:"file_display",label:"<img src='./public/img/no-image.png' height='120' width='120'>"}]}]),isFormNumeric(t,["machine_capacity","passenger_capacity","last_km"]);const e=e=>{0===e.length?t.setItemLabel("file_display","<img src='./public/img/no-image.png' height='120' width='120'>"):e.map((e=>{if(""===e)t.setItemLabel("file_display","<img src='./public/img/no-image.png' height='120' width='120'>");else{var a="<img src='./assets/images/vehicles/"+e+"' height='120' width='120'>";t.setItemLabel("file_display",a)}}))};fetchFormData(AppMaster("vehicleForm",{id:o.getSelectedRowId()}),t,["filename"],e),t.attachEvent("onBeforeFileAdd",(async function(e,a){u(t,{filename:e,size:a},t.getItemValue("id"))})),t.attachEvent("onBeforeFileUpload",(function(e,l,i){if(!a)return!0;clearUploader(t,"file_uploader"),eAlert("File error silahkan upload file sesuai ketentuan!"),a=!1})),t.attachEvent("onUploadFile",(function(e,a){reqJson(AppMaster("updateAfterUpload"),"POST",{id:t.getItemValue("id"),oldFile:t.getItemValue("filename"),filename:a,folder:"kf_general.vehicles"},((e,l)=>{"success"===l.status?(t.setItemValue("filename",a),clearUploader(t,"file_uploader"),t.setItemLabel("file_display","<img src='./assets/images/vehicles/"+a+"' height='120' width='120'>"),sAlert(l.message)):eAlert(l.message)}))})),t.attachEvent("onButtonClick",(function(e){switch(e){case"update":setDisable(["update","cancel"],t,i.cells("b"));let e=new dataProcessor(AppMaster("vehicleForm"));e.init(t),t.save(),e.attachEvent("onAfterUpdate",(function(e,a,l,n){let r=n.getAttribute("message");switch(a){case"updated":sAlert("Berhasil Mengubah Record <br>"+r),p(),i.cells("b").progressOff(),i.cells("b").showView("tambah_kendaraans"),i.cells("b").collapse();break;case"error":eAlert("Gagal Mengubah Record <br>"+r),setEnable(["update","cancel"],t,i.cells("b"))}}));break;case"cancel":i.cells("b").collapse(),i.cells("b").showView("tambah_kendaraan")}}))}()}})),n.attachEvent("onEnter",(function(e){switch(e){case"search":p(),o.attachEvent("onGridReconstructed",d)}})),r.attachEvent("onClick",(function(e){switch(e){case"update":if(!o.getChangedRows())return eAlert("Belum ada row yang di edit!");r.setItemDisabled("update"),i.cells("a").progressOn(),vehicleGridDP.sendData(),vehicleGridDP.attachEvent("onAfterUpdate",(function(e,t,a,l){let n=l.getAttribute("message");switch(t){case"updated":sAlert(n),p(),r.setItemEnabled("update"),i.cells("a").progressOff(),c();break;case"error":eAlert(n),r.setItemEnabled("update"),i.cells("a").progressOff()}}))}}))}

JS;

header('Content-Type: application/javascript');
echo $script;
