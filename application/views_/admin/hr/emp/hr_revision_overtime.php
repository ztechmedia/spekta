<?php 
if ((strpos(strtolower($_SERVER['SCRIPT_NAME']), strtolower(basename(__FILE__)))) !== false) { // NOT FALSE if the script"s file name is found in the URL
    header('HTTP/1.0 403 Forbidden');
    die('<h2>Direct access to this page is not allowed.</h2>');
}

$script = <<< "JS"
	
    function showHrRevisionOvertime(){var t=legendGrid(),e=mainTab.cells("hr_revision_overtime").attachLayout({pattern:"3J",cells:[{id:"a",text:"Daftar Permintaan Revisi Lembur"},{id:"b",text:"Instruksi Revisi",collapse:!0,width:450},{id:"c",text:"Detail Permintaan Revisi",collapse:!0}]});let a=filterForMonth(new Date);e.cells("a").attachMenu({icon_path:"./public/codebase/icons/",items:[{id:"search",text:"<div style='width:100%'>Search: <input type='text' id='hr_start_ovt_rev' readonly value='"+a.start+"' /> - <input type='text' id='hr_end_ovt_rev' readonly value='"+a.end+"' /> <button id='hr_btn_ftr_ovt_rev'>Proses</button> | Status: <select id='hr_status_ovt_rev'><option>ALL</option><option selected value='ACTIVE'>AKTIF (CREATED & PROCESS)</option><option>PROCESS</option><option>REJECTED</option><option>CLOSED</option></select></div>"}]});$("#hr_btn_ftr_ovt_rev").on("click",(function(){checkFilterDate($("#hr_start_ovt_rev").val(),$("#hr_end_ovt_rev").val())&&n()})),$("#hr_status_ovt_rev").on("change",(function(){n()}));var i=e.cells("a").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"refresh",text:"Refresh",type:"button",img:"refresh.png"},{id:"process",text:"Proses Permintaan Revisi",type:"button",img:"ok.png"},{id:"reject",text:"Tolak Permintaan Revisi",type:"button",img:"messagebox_critical.png"},{id:"attachment",text:"Lihat Attachment",type:"button",img:"attachment.png"}]});i.attachEvent("onClick",(function(t){switch(t){case"refresh":n(),c();break;case"process":reqConfirm(l,Overtime("processRevision"),1,((t,e)=>{n(),c(),e.mSuccess&&sAlert("Sukses Memproses Permintaan Revisi<br>"+e.mSuccess),e.mError&&eAlert("Gagal Memproses Permintaan Revisi<br>"+e.mError)}));break;case"reject":reqAction(l,Overtime("rejectRevision"),1,((t,e)=>{n(),c(),e.mSuccess&&sAlert("Sukses Menolak Permintaan Revisi<br>"+e.mSuccess),e.mError&&eAlert("Gagal Menolak Permintaan Revisi<br>"+e.mError)}));break;case"attachment":if(!l.getSelectedRowId())return eAlert("Pilih permintaan revisi!");reqJson(Overtime("viewAttachment"),"POST",{taskId:l.getSelectedRowId()},((t,e)=>{if("success"===e.status){var a=createWindow("hr_ovt_rev_attachment","Attachment Revisi: "+l.getSelectedRowId(),800,500);myWins.window("hr_ovt_rev_attachment").skipMyCloseEvent=!0,a.attachHTMLString(e.template)}}))}}));var r=e.cells("a").attachStatusBar();function s(){let e=l.getRowsNum();r.setText("Total baris: "+e+" ("+t.revision_overtime+")")}var l=e.cells("a").attachGrid();function n(){e.cells("a").progressOn();let t=$("#hr_start_ovt_rev").val(),a=$("#hr_end_ovt_rev").val(),i=$("#hr_status_ovt_rev").val(),r={betweendate_created_at:t+","+a};"ALL"!=i&&("ACTIVE"==i?r.in_status="CREATED,PROCESS":r.equal_status=i),e.cells("b").attachHTMLString("<div style='width:100%;height:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;'><p style='font-family:sans-serif'>Tidak ada revisi dipilih</p></div>"),l.clearAndLoad(Overtime("getRevOvtGrid",r),s)}l.setImagePath("./public/codebase/imgs/"),l.setHeader("No,Task ID,Deskripsi,Bagian,Sub Bagian,Status,Created By,Updated By,DiBuat"),l.attachHeader("#rspan,#text_filter,#text_filter,#select_filter,#select_filter,#select_filter,#text_filter,#text_filter,#text_filter"),l.setColSorting("int,str,str,str,str,str,str,str,str"),l.setColTypes("rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt"),l.setColAlign("center,left,left,left,left,left,left,left,left"),l.setInitWidthsP("5,20,35,20,20,20,20,20,25"),l.enableMultiselect(!0),l.enableSmartRendering(!0),l.attachEvent("onRowSelect",(function(t,e){let a=l.cells(t,5).getValue();"CLOSED"===a||"REJECTED"===a?(i.disableItem("process"),i.disableItem("reject"),d.disableItem("revision"),d.disableItem("closed")):"PROCESS"===a?(i.disableItem("process"),i.enableItem("reject")):(i.enableItem("process"),i.enableItem("reject"))})),l.attachEvent("onRowDblClicked",(function(t,e){c(t)})),l.attachEvent("onXLE",(function(){e.cells("a").progressOff()})),l.init();var o=e.cells("c").attachGrid();function c(t=null){t?(e.cells("c").progressOn(),e.cells("c").expand(),o.clearAndLoad(Overtime("getRevOvtDtlGrid",{taskId:t})),e.cells("b").expand(),reqJson(Overtime("getRevision"),"POST",{taskId:t},((t,a)=>{var i=e.cells("b").attachForm([{type:"block",offsetLeft:5,list:[{type:"input",name:"task_id",label:"Task ID",labelWidth:130,inputWidth:385,readonly:!0,required:!0,value:a.revision.task_id},{type:"editor",name:"description",label:"Keterangan",labelWidth:130,inputWidth:385,inputHeight:200,required:!0,value:a.revision.description},{type:"editor",name:"response",label:"Tanggapan SDM",labelWidth:130,inputWidth:385,inputHeight:210,required:!0,value:a.revision.response},{type:"block",offsetTop:30,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Simpan"}]}]}]);"PROCESS"==l.cells(l.getSelectedRowId(),5).getValue()||"CREATED"==l.cells(l.getSelectedRowId(),5).getValue()?setEnable(["update"],i):setDisable(["update"],i),i.attachEvent("onButtonClick",(function(t){switch(t){case"update":if(!i.validate())return eAlert("Input error!");setDisable(["update"],i,e.cells("b"));let t=new dataProcessor(Overtime("updateRevOvtRes"));t.init(i),i.save(),t.attachEvent("onAfterUpdate",(function(t,a,r,s){let l=s.getAttribute("message");switch(a){case"updated":sAlert(l),setEnable(["update"],i,e.cells("b"));break;case"error":eAlert(l),setEnable(["update"],i,e.cells("b"))}}))}}))}))):(e.cells("c").collapse(),e.cells("b").collapse(),o.clearAll())}o.setImagePath("./public/codebase/imgs/"),o.setHeader("No,Task ID,,Created By,Updated By,DiBuat"),o.setHeader("No,Task ID,Nama Karyawan,Bagian,Sub Bagian,Nama Mesin #1,Nama Mesin #2,Pelayanan Produksi,Tanggal Overtime,Waktu Mulai,Waktu Selesai,Status Hari,Jam Efektif,Jam Istirahat,Jam Ril,Jam Lembur,Premi,Nominal Overtime,Makan,Biaya Makan,Tugas,Status Overtime,DiBuat"),o.attachHeader("#rspan,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter"),o.setColSorting("int,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str"),o.setColTypes("rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt"),o.setColAlign("center,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left"),o.setInitWidthsP("5,20,20,20,20,20,20,20,20,20,20,15,15,15,15,15,15,15,15,15,30,25"),o.enableSmartRendering(!0),o.enableMultiselect(!0),o.attachEvent("onXLE",(function(){e.cells("c").progressOff()})),o.attachEvent("onRowSelect",(function(t,e){"PROCESS"!=l.cells(l.getSelectedRowId(),5).getValue()?(d.disableItem("revision"),d.disableItem("closed")):(d.enableItem("revision"),d.enableItem("closed"))})),o.init();var d=e.cells("c").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"revision",text:"Revisi Jam Lembur",type:"button",img:"clock.png"},{id:"closed",text:"Tutup Revisi",type:"button",img:"check.png"}]}),u=createTime();d.attachEvent("onClick",(function(t){switch(t){case"revision":if(!o.getSelectedRowId())return eAlert("Pilih baris yang akan di revisi!");var e=createWindow("hr_hour_revision","Revisi Waktu Lembur",510,300);myWins.window("hr_hour_revision").skipMyCloseEvent=!0;let t=getCurrentTime(o,9,10),s=t.labelStart,d=t.labelEnd;var a=e.attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Jam Lembur",list:[{type:"block",list:[{type:"input",name:"task_id",label:"Task ID",labelWidth:130,inputWidth:250,readonly:!0,value:o.getSelectedRowId()},{type:"combo",name:"start_date",label:s,labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:u.startTimes},{type:"combo",name:"end_date",label:d,labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:u.endTimes}]}]},{type:"newcolumn"},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Update"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Clear"}]}]),i=a.getCombo("start_date"),r=a.getCombo("end_date");let p=u.filterStartTime.indexOf(t.start),f=u.filterEndTime.indexOf(t.end);i.selectOption(p),r.selectOption(f),a.attachEvent("onButtonClick",(function(t){switch(t){case"update":setDisable(["update","cancel"],a,e);let t=new dataProcessor(Overtime("updateRevisionHour"));t.init(a),a.save(),t.attachEvent("onAfterUpdate",(function(t,i,r,s){let n=s.getAttribute("message");switch(i){case"updated":c(l.getSelectedRowId()),sAlert(n),setEnable(["update","cancel"],a,e),closeWindow("hr_hour_revision");break;case"error":eaAlert("Kesalahan Waktu Lembur",n),setEnable(["update","cancel"],a,e)}}));break;case"cancel":closeWindow("hr_hour_revision")}}));break;case"closed":if(!l.getSelectedRowId())return eAlert("Pilih baris yang akan di tutup!");dhtmlx.modalbox({type:"alert-warning",title:"Konfirmasi Tutup Revisi",text:"Anda yakin akan menutup revisi lembur "+l.getSelectedRowId()+"?",buttons:["Ya","Tidak"],callback:function(t){0==t&&reqJson(Overtime("closeRevision"),"POST",{taskId:l.getSelectedRowId()},((t,e)=>{"success"===e.status&&(n(),c(),sAlert(e.message))}))}})}})),n(),c()}

JS;

header('Content-Type: application/javascript');
echo $script;