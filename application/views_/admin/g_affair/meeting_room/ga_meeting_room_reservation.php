<?php 
if ((strpos(strtolower($_SERVER['SCRIPT_NAME']), strtolower(basename(__FILE__)))) !== false) { // NOT FALSE if the script"s file name is found in the URL
    header('HTTP/1.0 403 Forbidden');
    die('<h2>Direct access to this page is not allowed.</h2>');
}

$script = <<< "JS"

    var currSnack;function showMeetingRev(){var e=legendGrid(),t=mainTab.cells("ga_meeting_rooms_reservation").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"refresh",text:"Refresh",type:"button",img:"refresh.png"},{id:"approve",text:"Approve",type:"button",img:"ok.png"},{id:"reject",text:"Reject",type:"button",img:"messagebox_critical.png"},{id:"snack",text:"Pilih Snack",type:"button",img:"food.png"},{id:"searchtext",text:"Cari : ",type:"text"},{id:"search",text:"",type:"buttonInput",width:150}]});t.attachEvent("onClick",(function(e){switch(e){case"refresh":t.setValue("search",""),c(),t.enableItem("approve"),t.enableItem("reject"),t.enableItem("snack"),o.enableItem("update"),o.enableItem("change_hour"),o.enableItem("closed");break;case"approve":case"snack":if(!l.getSelectedRowId())return eAlert("Pilih reservasi yang akan di approve");if("-"!=l.cells(l.getSelectedRowId(),9).getValue()){var a=createWindow("ga_appv_mroom","Pilih Snack Meeting",800,400);myWins.window("ga_appv_mroom").skipMyCloseEvent=!0;var r=a.attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"approve",text:"Approve",type:"button",img:"ok.png"},{id:"cancel",text:"Cancel",type:"button",img:"messagebox_critical.png"},{id:"snack",text:"Ubah Snack",type:"button",img:"refresh.png"}]});"CREATED"==l.cells(l.getSelectedRowId(),17).getValue()?(r.enableItem("approve"),r.disableItem("snack")):(r.disableItem("approve"),r.enableItem("snack")),reqJson(GAOther("getSnacks"),"POST",{id:l.getSelectedRowId()},((e,t)=>{currSnack=t.snack_id,"success"===t.status&&a.attachHTMLString(t.template)})),r.attachEvent("onClick",(function(e){switch(e){case"approve":if(!currSnack)return eaAlert("Pilih Snack","Silahkan pilih snack yang akan diberikan ke peserta meeting!");reqJson(GAOther("appvReservation"),"POST",{id:l.getSelectedRowId(),snackId:currSnack},((e,t)=>{"success"===t.status?(c(),sAlert(t.message),closeWindow("ga_appv_mroom")):eaAlert("Error",t.message)}));break;case"snack":reqJson(GAOther("changeRevSnack"),"POST",{id:l.getSelectedRowId(),snackId:currSnack},((e,t)=>{"success"===t.status?(c(),sAlert(t.message),closeWindow("ga_appv_mroom")):eaAlert("Error",t.message)}));break;case"cancel":closeWindow("ga_appv_mroom")}}))}else dhtmlx.modalbox({type:"alert-warning",title:"Konfirmasi",text:"Approve jadwal meeting "+l.cells(l.getSelectedRowId(),1).getValue()+"?",buttons:["Ya","Tidak"],callback:function(e){0==e&&reqJson(GAOther("appvReservation"),"POST",{id:l.getSelectedRowId()},((e,t)=>{"success"===t.status?(c(),sAlert(t.message)):eAlert(t.message)}))}});break;case"reject":if(!l.getSelectedRowId())return eAlert("Pilih reservasi yang akan di tolak");var n=createWindow("ga_reject_mroom","Form Alasan Penolakan",590,320);myWins.window("ga_reject_mroom").skipMyCloseEvent=!0;var s=n.attachForm([{type:"fieldset",offsetTop:30,offsetLeft:30,label:"Alasan Penolakan",list:[{type:"hidden",name:"id",labelWidth:130,inputWidth:350,required:!0,value:l.getSelectedRowId()},{type:"input",name:"reason",label:"Komentas",labelWidth:130,inputWidth:350,required:!0,rows:5},{type:"block",offsetTop:30,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Simpan"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Cancel"}]}]}]);s.attachEvent("onButtonClick",(function(e){switch(e){case"update":if(!s.validate())return eAlert("Input error!");setDisable(["update","cancel"],s,n);let e=new dataProcessor(GAOther("rejectReservation"));e.init(s),s.save(),e.attachEvent("onAfterUpdate",(function(e,t,a,r){let o=r.getAttribute("message");switch(t){case"updated":sAlert(o),c(),clearAllForm(s),setEnable(["update","cancel"],s,n),closeWindow("ga_reject_mroom");break;case"error":eAlert(o),setEnable(["update","cancel"],s,n)}}));break;case"cancel":closeWindow("ga_reject_mroom")}}))}})),t.attachEvent("onEnter",(function(e){switch(e){case"search":c(),l.attachEvent("onGridReconstructed",s)}}));let a=filterForMonth(new Date);mainTab.cells("ga_meeting_rooms_reservation").attachMenu({icon_path:"./public/codebase/icons/",items:[{id:"search",text:"<div style='width:100%'>Search: <input type='text' id='ga_start_mroom_rev' readonly value='"+a.start+"' /> - <input type='text' id='ga_end_mroom_rev' readonly value='"+a.end+"' /> <button id='ga_btn_mroom_rev'>Proses</button> | Status: <select id='ga_status_mroom_rev'><option>ALL</option><option>CREATED</option><option>APPROVED</option><option>REJECTED</option><option>CLOSED</option></select>"}]}),new dhtmlXCalendarObject(["ga_start_mroom_rev","ga_end_mroom_rev"]);$("#ga_btn_mroom_rev").on("click",(function(){checkFilterDate($("#ga_start_mroom_rev").val(),$("#ga_end_mroom_rev").val())&&c()})),$("#ga_status_mroom_rev").on("change",(function(){c()}));var r=mainTab.cells("ga_meeting_rooms_reservation").attachLayout({pattern:"1C",cells:[{id:"a",header:!1}]}),o=r.cells("a").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"update",text:"Update Data kehadiran",type:"button",img:"update.png"},{id:"change_hour",text:"Ubah Waktu Reservasi",type:"button",img:"clock.png"},{id:"closed",text:"Tutup Meeting",type:"button",img:"ok.png"}]});o.attachEvent("onClick",(function(e){switch(e){case"update":if(!l.getChangedRows())return eAlert("Belum ada row yang di edit!");o.disableItem("update"),r.cells("a").progressOn(),revMRoomGridDP.sendData(),revMRoomGridDP.attachEvent("onAfterUpdate",(function(e,t,a,n){let s=n.getAttribute("message");switch(t){case"updated":let e=s.split(",");e.length>=1&&""!=e[0]&&sAlert(e[0]),e.length>=2&&""!=e[1]&&eAlert(e[1]),c(),o.enableItem("update"),r.cells("a").progressOff(),i()}}));break;case"change_hour":if(!l.getSelectedRowId())return eAlert("Belum ada row yang di pilih!");var t=createWindow("ch_win_mroom","Ubah Waktu Reservasi",500,300);myWins.window("ch_win_mroom").skipMyCloseEvent=!0;var a=createTime("full");let e=getCurrentTime(l,6,7),m=e.labelStart,u=e.labelEnd;var n=t.attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Waktu Reservasi Ruang Meeting",list:[{type:"block",list:[{type:"hidden",name:"id",label:"ID",labelWidth:130,inputWidth:250,value:l.getSelectedRowId()},{type:"combo",name:"start_date",label:m,labelWidth:130,inputWidth:250,readonly:!0,required:!0,validate:"NotEmpty",options:a.startTimes},{type:"combo",name:"end_date",label:u,labelWidth:130,inputWidth:250,readonly:!0,required:!0,validate:"NotEmpty",options:a.endTimes}]}]},{type:"newcolumn"},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Update"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Clear"}]}]),s=n.getCombo("start_date"),d=n.getCombo("end_date");let p=a.filterStartTime.indexOf(e.start),g=a.filterEndTime.indexOf(e.end);s.selectOption(p),d.selectOption(g),n.attachEvent("onButtonClick",(function(e){switch(e){case"update":setDisable(["update","cancel"],n,t);let e=new dataProcessor(GAOther("changeRevTime"));e.init(n),n.save(),e.attachEvent("onAfterUpdate",(function(e,a,r,o){let s=o.getAttribute("message");switch(a){case"updated":c(),sAlert(s),setEnable(["update","cancel"],n,t),closeWindow("ch_win_mroom");break;case"error":eaAlert("Kesalahan Waktu Reservasi",s),setEnable(["update","cancel"],n,t)}}));break;case"cancel":closeWindow("ch_win_mroom")}}));break;case"closed":if(!l.getSelectedRowId())return eAlert("Belum ada row yang di edit!");dhtmlx.modalbox({type:"alert-warning",title:"Konfirmasi Tutup Meeting",text:"Anda yakin ?",buttons:["Ya","Tidak"],callback:function(e){0==e&&(o.disableItem("closed"),reqJson(GAOther("closeReservation"),"POST",{id:l.getSelectedRowId()},((e,t)=>{"success"===t.status&&(c(),sAlert(t.message),o.enableItem("closed"))})))}})}}));var n=r.cells("a").attachStatusBar();function s(){let t=l.getRowsNum();n.setText("Total baris: "+t+" ("+e.m_room_rev+")"),sumGridToElement(l,16,"ga_total_snack")}var l=r.cells("a").attachGrid();function i(){revMRoomGridDP=new dataProcessor(GAOther("updateConfirmBatch")),revMRoomGridDP.setTransactionMode("POST",!0),revMRoomGridDP.setUpdateMode("Off"),revMRoomGridDP.init(l)}function c(){r.cells("a").progressOn();let e=$("#ga_start_mroom_rev").val(),a=$("#ga_end_mroom_rev").val(),o=$("#ga_status_mroom_rev").val(),n={search:t.getValue("search"),betweendate_start_date:e+","+a};"ALL"!=o&&(n.equal_status=o),l.clearAndLoad(GAOther("getMeetingRevGrid",n),s)}l.setHeader("No,No. Tiket,No. Ref,Topik Meeting,Jenis Meeting,Ruang Meeting,Waktu Mulai,Waktu Selesai,Druasi,Snack,Total Peserta,Konfirmasi Hadir,Konfirmasi Tidak Hadir,Belum Konfirmasi,Snack,Harga Snack,Total,Status,Alasan Penolakan,Created By,Updated By,DiBuat"),l.attachHeader("#rspan,#text_filter,#text_filter,#text_filter,#select_filter,#select_filter,#text_filter,#text_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter"),l.setColSorting("str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str"),l.setColTypes("rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,edtxt,rotxt,rotxt,rotxt,ron,ron,rotxt,rotxt,rotxt,rotxt,rotxt"),l.setColAlign("center,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left"),l.setInitWidthsP("5,15,15,25,15,15,20,20,10,10,10,10,10,10,15,15,15,15,30,15,15,25"),l.attachFooter(",Total Biaya Snack,,,,,,,,,,,,,,,<div id='ga_total_snack'>0</div>,,,,,,"),l.enableSmartRendering(!0),l.setEditable(!0),l.attachEvent("onXLE",(function(){r.cells("a").progressOff()})),l.setNumberFormat("0,000",15,".",","),l.setNumberFormat("0,000",16,".",","),isGridNumeric(l,[10,11,12,13,15,16]),l.attachEvent("onRowSelect",(function(e,a){"APPROVED"==l.cells(e,17).getValue()?(t.disableItem("approve"),t.disableItem("reject"),"-"==l.cells(e,9).getValue()?t.disableItem("snack"):t.enableItem("snack"),o.enableItem("update"),o.enableItem("change_hour"),o.enableItem("closed")):"REJECTED"==l.cells(e,17).getValue()||"CLOSED"==l.cells(e,17).getValue()?(t.disableItem("approve"),t.disableItem("reject"),t.disableItem("snack"),o.disableItem("update"),o.disableItem("change_hour"),o.disableItem("closed")):(userLogged.rankId>=3&&userLogged.rankId<=6&&"-"==l.cells(e,2).getValue()?(t.enableItem("approve"),t.enableItem("reject"),t.disableItem("snack")):(t.disableItem("approve"),t.disableItem("reject"),t.disableItem("snack")),o.disableItem("update"),o.disableItem("change_hour"),o.disableItem("closed"))})),i(),l.init(),c()}function selectSnack(e){currSnack=e,$(".snack_selected").removeClass("snack_selected"),$("#snack-"+e).addClass("snack_selected")}

JS;

header('Content-Type: application/javascript');
echo $script;
