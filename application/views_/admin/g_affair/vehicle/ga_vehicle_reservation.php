<?php 
if ((strpos(strtolower($_SERVER['SCRIPT_NAME']), strtolower(basename(__FILE__)))) !== false) { // NOT FALSE if the script"s file name is found in the URL
    header('HTTP/1.0 403 Forbidden');
    die('<h2>Direct access to this page is not allowed.</h2>');
}

$script = <<< "JS"

	function showVehicleRev(){var e=legendGrid(),t=mainTab.cells("ga_vehicles_reservation").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"refresh",text:"Refresh",type:"button",img:"refresh.png"},{id:"approve",text:"Approve",type:"button",img:"ok.png"},{id:"reject",text:"Reject",type:"button",img:"messagebox_critical.png"},{id:"driver",text:"Pilih Driver",type:"button",img:"person_16.png"},{id:"vehicle",text:"Pilih Kendaraan",type:"button",img:"car_16.png"},{id:"searchtext",text:"Cari : ",type:"text"},{id:"search",text:"",type:"buttonInput",width:150}]});t.attachEvent("onClick",(function(e){switch(e){case"refresh":t.setValue("search",""),o(),t.enableItem("approve"),t.enableItem("reject"),t.enableItem("driver"),t.enableItem("vehicle"),i.enableItem("update"),i.enableItem("change_hour"),i.enableItem("closed");break;case"approve":if(!s.getSelectedRowId())return eAlert("Pilih reservasi yang akan di approve");dhtmlx.modalbox({type:"alert-warning",title:"Konfirmasi",text:"Approve jadwal perjalanan "+s.cells(s.getSelectedRowId(),1).getValue()+"?",buttons:["Ya","Tidak"],callback:function(e){0==e&&reqJson(GAOther("appvVehicleRev"),"POST",{id:s.getSelectedRowId()},((e,t)=>{"success"===t.status?(o(),sAlert(t.message)):eAlert(t.message)}))}});break;case"reject":if(!s.getSelectedRowId())return eAlert("Pilih reservasi yang akan di tolak");var a=createWindow("ga_reject_vehicle","Form Alasan Penolakan",590,320);myWins.window("ga_reject_vehicle").skipMyCloseEvent=!0;var l=a.attachForm([{type:"fieldset",offsetTop:30,offsetLeft:30,label:"Alasan Penolakan",list:[{type:"hidden",name:"id",labelWidth:130,inputWidth:350,required:!0,value:s.getSelectedRowId()},{type:"input",name:"reason",label:"Komentas",labelWidth:130,inputWidth:350,required:!0,rows:5},{type:"block",offsetTop:30,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Simpan"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Cancel"}]}]}]);l.attachEvent("onButtonClick",(function(e){switch(e){case"update":if(!l.validate())return eAlert("Input error!");setDisable(["update","cancel"],l,a);let e=new dataProcessor(GAOther("rejectVehicleRev"));e.init(l),l.save(),e.attachEvent("onAfterUpdate",(function(e,t,i,r){let n=r.getAttribute("message");switch(t){case"updated":sAlert(n),o(),clearAllForm(l),setEnable(["update","cancel"],l,a),closeWindow("ga_reject_vehicle");break;case"error":eAlert(n),setEnable(["update","cancel"],l,a)}}));break;case"cancel":closeWindow("ga_reject_vehicle")}}));break;case"driver":if(!s.getSelectedRowId())return eAlert("Pilih reservasi yang akan di update drivernya");var r=createWindow("ga_change_driver","Form Driver",590,320);myWins.window("ga_change_driver").skipMyCloseEvent=!0;var n=r.attachForm([{type:"fieldset",offsetTop:30,offsetLeft:30,label:"Pilih Driver Yang Tersedia",list:[{type:"hidden",name:"id",labelWidth:130,inputWidth:350,required:!0,value:s.getSelectedRowId()},{type:"combo",name:"driver",label:"Driver",labelWidth:130,inputWidth:350,readonly:!0,required:!0},{type:"block",offsetTop:30,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Simpan"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Cancel"}]}]}]);n.getCombo("driver").load(GAOther("changeDriverList",{id:s.getSelectedRowId()})),n.attachEvent("onButtonClick",(function(e){switch(e){case"update":if(!n.validate())return eAlert("Input error!");setDisable(["update","cancel"],n,r);let e=new dataProcessor(GAOther("changeDriverRev"));e.init(n),n.save(),e.attachEvent("onAfterUpdate",(function(e,t,a,l){let i=l.getAttribute("message");switch(t){case"updated":sAlert(i),o(),clearAllForm(n),setEnable(["update","cancel"],n,r),closeWindow("ga_change_driver");break;case"error":eAlert(i),setEnable(["update","cancel"],n,r)}}));break;case"cancel":closeWindow("ga_change_driver")}}));break;case"vehicle":if(!s.getSelectedRowId())return eAlert("Pilih reservasi yang akan di update drivernya");var c=createWindow("ga_change_vehicle","Form Kendaraan",590,320);myWins.window("ga_change_vehicle").skipMyCloseEvent=!0;var d=c.attachForm([{type:"fieldset",offsetTop:30,offsetLeft:30,label:"Pilih Kendaraan Yang Tersedia",list:[{type:"hidden",name:"id",labelWidth:130,inputWidth:350,required:!0,value:s.getSelectedRowId()},{type:"combo",name:"vehicle",label:"Kendaraan Dinas",labelWidth:130,inputWidth:350,readonly:!0,required:!0},{type:"block",offsetTop:30,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Simpan"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Cancel"}]}]}]);d.getCombo("vehicle").load(GAOther("changeVehicleList",{id:s.getSelectedRowId()})),d.attachEvent("onButtonClick",(function(e){switch(e){case"update":if(!d.validate())return eAlert("Input error!");setDisable(["update","cancel"],d,c);let e=new dataProcessor(GAOther("changeVehicleRev"));e.init(d),d.save(),e.attachEvent("onAfterUpdate",(function(e,t,a,l){let i=l.getAttribute("message");switch(t){case"updated":sAlert(i),o(),clearAllForm(d),setEnable(["update","cancel"],d,c),closeWindow("ga_change_vehicle");break;case"error":eAlert(i),setEnable(["update","cancel"],d,c)}}));break;case"cancel":closeWindow("ga_change_vehicle")}}))}})),t.attachEvent("onEnter",(function(e){switch(e){case"search":o(),s.attachEvent("onGridReconstructed",n)}}));let a=filterForMonth(new Date);mainTab.cells("ga_vehicles_reservation").attachMenu({icon_path:"./public/codebase/icons/",items:[{id:"search",text:"<div style='width:100%'>Search: <input type='text' id='ga_start_vehicle_rev' readonly value='"+a.start+"' /> - <input type='text' id='ga_end_vehicle_rev' readonly value='"+a.end+"' /> <button id='ga_btn_vehicle_rev'>Proses</button> | Status: <select id='ga_status_vehicle_rev'><option>ALL</option><option>CREATED</option><option>APPROVED</option><option>REJECTED</option><option>CLOSED</option></select>"}]}),new dhtmlXCalendarObject(["ga_start_vehicle_rev","ga_end_vehicle_rev"]);$("#ga_btn_vehicle_rev").on("click",(function(){checkFilterDate($("#ga_start_vehicle_rev").val(),$("#ga_end_vehicle_rev").val())&&o()})),$("#ga_status_vehicle_rev").on("change",(function(){o()}));var l=mainTab.cells("ga_vehicles_reservation").attachLayout({pattern:"1C",cells:[{id:"a",header:!1}]}),i=l.cells("a").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"update",text:"Update Jumlah Penumpang & Kilomter",type:"button",img:"update.png"},{id:"change_hour",text:"Ubah Waktu Reservasi",type:"button",img:"clock.png"},{id:"closed",text:"Tutup Meeting",type:"button",img:"ok.png"}]});i.attachEvent("onClick",(function(e){switch(e){case"update":if(!s.getChangedRows())return eAlert("Belum ada row yang di edit!");i.disableItem("update"),l.cells("a").progressOn(),revVehicleGridDP.sendData(),revVehicleGridDP.attachEvent("onAfterUpdate",(function(e,t,a,r){let n=r.getAttribute("message");switch(t){case"updated":let e=n.split(",");e.length>=1&&""!=e[0]&&sAlert(e[0]),e.length>=2&&""!=e[1]&&eAlert(e[1]),o(),i.enableItem("update"),l.cells("a").progressOff(),c()}}));break;case"change_hour":if(!s.getSelectedRowId())return eAlert("Belum ada row yang di pilih!");var t=createWindow("ch_win_vehicle","Ubah Waktu Reservasi",500,300);myWins.window("ch_win_vehicle").skipMyCloseEvent=!0;var a=createTime("full");let e=getCurrentTime(s,10,11),u=e.labelStart,h=e.labelEnd;var r=t.attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Waktu Reservasi Kendaraan",list:[{type:"block",list:[{type:"hidden",name:"id",label:"ID",labelWidth:130,inputWidth:250,value:s.getSelectedRowId()},{type:"combo",name:"start_date",label:u,labelWidth:130,inputWidth:250,readonly:!0,required:!0,validate:"NotEmpty",options:a.startTimes},{type:"combo",name:"end_date",label:h,labelWidth:130,inputWidth:250,readonly:!0,required:!0,validate:"NotEmpty",options:a.endTimes}]}]},{type:"newcolumn"},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Update"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Cancel"}]}]),n=r.getCombo("start_date"),d=r.getCombo("end_date");let p=a.filterStartTime.indexOf(e.start),v=a.filterEndTime.indexOf(e.end);n.selectOption(p),d.selectOption(v),r.attachEvent("onButtonClick",(function(e){switch(e){case"update":setDisable(["update","cancel"],r,t);let e=new dataProcessor(GAOther("changeVehicleRevTime"));e.init(r),r.save(),e.attachEvent("onAfterUpdate",(function(e,a,l,i){let n=i.getAttribute("message");switch(a){case"updated":o(),sAlert(n),setEnable(["update","cancel"],r,t),closeWindow("ch_win_vehicle");break;case"error":eaAlert("Kesalahan Waktu Reservasi",n),setEnable(["update","cancel"],r,t)}}));break;case"cancel":closeWindow("ch_win_vehicle")}}));break;case"closed":if(!s.getSelectedRowId())return eAlert("Belum ada row yang di edit!");dhtmlx.modalbox({type:"alert-warning",title:"Konfirmasi Tutup Perjalanan",text:"Anda yakin ?",buttons:["Ya","Tidak"],callback:function(e){0==e&&(i.disableItem("closed"),reqJson(GAOther("closeVehicleRev"),"POST",{id:s.getSelectedRowId()},((e,t)=>{"success"===t.status&&(o(),sAlert(t.message),i.enableItem("closed"))})))}})}}));var r=l.cells("a").attachStatusBar();function n(){let t=s.getRowsNum();r.setText("Total baris: "+t+" ("+e.m_room_rev+")")}var s=l.cells("a").attachGrid();function c(){revVehicleGridDP=new dataProcessor(GAOther("updateVehicleRevBatch")),revVehicleGridDP.setTransactionMode("POST",!0),revVehicleGridDP.setUpdateMode("Off"),revVehicleGridDP.init(s)}function o(){l.cells("a").progressOn();let e=$("#ga_start_vehicle_rev").val(),a=$("#ga_end_vehicle_rev").val(),i=$("#ga_status_vehicle_rev").val(),r={search:t.getValue("search"),betweendate_start_date:e+","+a};"ALL"!=i&&(r.equal_status=i),s.clearAndLoad(GAOther("getVehicleRevGrid",r),n)}s.setHeader("No,No. Tiket,Tujuan,Jenis Perjalanan,Kendaraan,Driver,Konfirmasi Driver,Kilometer Awal,Kilometer Akhir,Jarak Tempuh,Waktu Mulai,Waktu Selesai,Druasi,Jumlah Penumpang,Status,Alasan Penolakan,Created By,Updated By,DiBuat"),s.attachHeader("#rspan,#text_filter,#text_filter,#select_filter,#select_filter,#select_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter"),s.setColSorting("str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str"),s.setColTypes("rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,edtxt,edtxt,rotxt,rotxt,rotxt,ron,edtxt,rotxt,rotxt,rotxt,rotxt,rotxt"),s.setColAlign("center,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left"),s.setInitWidthsP("5,15,25,20,15,15,15,15,15,15,20,20,10,10,15,30,15,15,25"),s.attachFooter(",Total,,,,,,,,#stat_total,,,#stat_total,,,,,,"),s.enableSmartRendering(!0),s.setEditable(!0),s.attachEvent("onXLE",(function(){l.cells("a").progressOff()})),isGridNumeric(s,[7,8,13]),s.attachEvent("onRowSelect",(function(e,a){"APPROVED"==s.cells(e,14).getValue()?(t.disableItem("approve"),t.disableItem("reject"),t.enableItem("driver"),t.enableItem("vehicle"),i.enableItem("update"),i.enableItem("change_hour"),i.enableItem("closed")):"REJECTED"==s.cells(e,14).getValue()||"CLOSED"==s.cells(e,14).getValue()?(t.disableItem("approve"),t.disableItem("reject"),t.disableItem("driver"),t.disableItem("vehicle"),i.disableItem("update"),i.disableItem("change_hour"),i.disableItem("closed")):(userLogged.rankId>=3&&userLogged.rankId<=6?(t.enableItem("approve"),t.enableItem("reject"),t.disableItem("driver"),t.disableItem("vehicle")):(t.disableItem("approve"),t.disableItem("reject"),t.disableItem("driver"),t.disableItem("vehicle")),i.disableItem("update"),i.disableItem("change_hour"),i.disableItem("closed"))})),c(),s.init(),o()}

JS;

header('Content-Type: application/javascript');
echo $script;
