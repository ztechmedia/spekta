<?php 
if ((strpos(strtolower($_SERVER['SCRIPT_NAME']), strtolower(basename(__FILE__)))) !== false) { // NOT FALSE if the script"s file name is found in the URL
    header('HTTP/1.0 403 Forbidden');
    die('<h2>Direct access to this page is not allowed.</h2>');
}

$script = <<< "JS"
	
    function showInputOvertime(){var e,t=legendGrid(),a=[],i=[],l=[],r=[],n=[],s={department_id:{url:Overtime("getDepartment"),reload:!0},sub_department_id:{reload:!1},division_id:{reload:!1}},o=mainTab.cells("other_input_overtime").attachTabbar({tabs:[{id:"a",text:"Form Lembur",active:!0},{id:"b",text:"Proses Personil"}]}),d=createTime(),c=[{type:"combo",name:"department_id",label:"Sub Unit",labelWidth:130,inputWidth:250,readonly:!0,required:!0},{type:"combo",name:"sub_department_id",label:"Bagian",labelWidth:130,inputWidth:250,readonly:!0,required:!0},{type:"combo",name:"division_id",label:"Sub Bagian",labelWidth:130,inputWidth:250,readonly:!0,required:!0},{type:"input",name:"personil",label:"Kebutuhan Orang",labelWidth:130,inputWidth:250,required:!0,validate:"ValidNumeric"},{type:"calendar",name:"overtime_date",label:"Tanggal Lembur",labelWidth:130,inputWidth:250,readonly:!0,required:!0},{type:"combo",name:"start_date",label:"Waktu Mulai",labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:d.startTimes},{type:"combo",name:"end_date",label:"Waktu Selesai",labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:d.endTimes},{type:"input",name:"notes",label:"Catatan",labelWidth:130,inputWidth:250,rows:3},{type:"checkbox",name:"is_production",label:"Lembur Produksi",labelWidth:130,inputWidth:250},{type:"hidden",name:"machine_id",label:"ID Mesin",labelWidth:130,inputWidth:250,readonly:!0},{type:"input",name:"machine_name",label:"Nama Mesin",labelWidth:130,inputWidth:250,readonly:!0}];var m=reqJsonResponse(Overtime("getOTRequirement"),"GET",null).data,u=o.cells("a").attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Data Lembur",list:[{type:"block",list:c},{type:"newcolumn"},{type:"fieldset",offsetLeft:30,label:"Kebutuhan Lembur",list:m}]},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"add",className:"button_add",offsetLeft:15,value:"Tambah"},{type:"newcolumn"},{type:"button",name:"clear",className:"button_clear",offsetLeft:30,value:"Clear"}]}]);isFormNumeric(u,["personil"]),u.hideItem("machine_name");var f=u.getCombo("department_id"),p=u.getCombo("sub_department_id");f.load(Overtime("getDepartment",{equal_id:userLogged.deptId})),f.attachEvent("onChange",(function(e,t){clearComboReload(u,"sub_department_id",Overtime("getSubDepartment",{equal_department_id:e,equal_id:userLogged.subId,notequal_id:5}))})),p.attachEvent("onChange",(function(e,t){clearComboReload(u,"division_id",Emp("getDivision",{subDeptId:e}))}));var b=u.getCombo("start_date"),h=u.getCombo("end_date");h.selectOption(d.endTimes.length-1),u.attachEvent("onChange",(function(e,t){"start_date"===e||"end_date"===e?checkTime(b,h,["add","clear"],u):"is_production"===e&&(u.isItemChecked("is_production")?u.showItem("machine_name"):(u.hideItem("machine_name"),u.setItemValue("machine_id",""),u.setItemValue("machine_name","")))})),checkTime(b,h,["add","clear"],u),u.attachEvent("onFocus",(function(e,t){if("machine_name"===e){if(""===u.getItemValue("sub_department_id"))return eAlert("Silahkan pilih Sub Department terlebih dahulu!");var l=createWindow("machine_window","Daftar Mesin",900,500);myWins.window("machine_window").skipMyCloseEvent=!0,l.attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"save",text:"Simpan",type:"button",img:"ok.png"}]}).attachEvent("onClick",(function(e){switch(e){case"save":a=[],i=[];for(let e=0;e<machineGrid.getRowsNum();e++){let t=machineGrid.getRowId(e);1==machineGrid.cells(t,1).getValue()&&(a.push(t),i.push(machineGrid.cells(t,2).getValue()))}u.setItemValue("machine_id",a),u.setItemValue("machine_name",i),closeWindow("machine_window")}}));let e=l.attachStatusBar();l.progressOn(),machineGrid=l.attachGrid(),machineGrid.setImagePath("./public/codebase/imgs/"),machineGrid.setHeader("No,Check,Nama Mesin,Sub Unit,Bagian,Sub Bagian,Lokasi"),machineGrid.attachHeader("#rspan,#rspan,#text_filter,#select_filter,#select_filter,#select_filter,#text_filter"),machineGrid.setColSorting("int,na,str,str,str,str,str"),machineGrid.setColAlign("center,left,left,left,left,left,left"),machineGrid.setColTypes("rotxt,ch,rotxt,rotxt,rotxt,rotxt,rotxt"),machineGrid.setInitWidthsP("5,5,20,20,20,20,25"),machineGrid.enableSmartRendering(!0),machineGrid.attachEvent("onXLE",(function(){l.progressOff()})),machineGrid.init(),machineGrid.clearAndLoad(Overtime("getMachineGrid",{subId:u.getItemValue("sub_department_id")}),(function(){var t=machineGrid.getRowsNum();e.setText("Total baris: "+t),a.length>0&&a.map((e=>machineGrid.cells(e,1).setValue(1)))}))}})),u.attachEvent("onButtonClick",(function(e){switch(e){case"add":if(!u.validate())return eAlert("Input error!");setDisable(["add","clear"],u,o.cells("a"));let e=new dataProcessor(Overtime("createInitialOvertime"));e.init(u),u.save(),e.attachEvent("onAfterUpdate",(function(e,t,l,r){let n=r.getAttribute("message");switch(t){case"inserted":sAlert("Berhasil Menambahkan Record <br>"+n),a=[],i=[],clearAllForm(u,s,null,["start_date","end_date"]),x(),setEnable(["add","clear"],u,o.cells("a"));break;case"error":eaAlert("Kesalahan Waktu Lembur",n),setEnable(["add","clear"],u,o.cells("a"))}}));break;case"clear":clearAllForm(u,s,null,["start_date","end_date"])}}));var _=o.cells("b").attachLayout({pattern:"2E",cells:[{id:"a",text:"Daftar Form Lembur"},{id:"b",text:"Proses Personil",collapse:!0}]});_.cells("a").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"refresh",text:"Refresh",type:"button",img:"refresh.png"},{id:"cancel",text:"Batalkan",type:"button",img:"messagebox_critical.png"},{id:"personil",text:"Update Kebutuhan Personil",type:"button",img:"person_16.png"},{id:"hour_revision",text:"Revisi Waktu Lembur",type:"button",img:"clock.png"}]}).attachEvent("onClick",(function(t){switch(t){case"refresh":x(),formOvtDetailGrid.clearAll();break;case"cancel":if(!e.getSelectedRowId())return eAlert("Pilih baris yang akan dibatalkan!");let t=e.cells(e.getSelectedRowId(),1).getValue();dhtmlx.modalbox({type:"alert-warning",title:"Konfirmasi Form Lembur",text:"Anda yakin akan membatalkan lembur "+t+"?",buttons:["Ya","Tidak"],callback:function(e){0==e&&reqJson(Overtime("cancelOvertime"),"POST",{taskId:t},((e,t)=>{"success"===t.status&&(x(),formOvtDetailGrid.clearAll(),_.cells("b").setText("Proses Personil"),_.cells("b").collapse(),a=[],i=[],l=[],r=[],n=[]),sAlert(t.message)}))}});break;case"personil":if(!e.getSelectedRowId())return eAlert("Pilih baris yang akan dibatalkan!");let f=e.cells(e.getSelectedRowId(),5).getValue().replace(" Orang",""),p=createWindow("input_change_personil","Update Kebutuhan Orang",500,250);myWins.window("input_change_personil").skipMyCloseEvent=!0;var s=p.attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Jumlah Kebutuhan Orang",list:[{type:"block",list:[{type:"hidden",name:"task_id",label:"ID",readonly:!0,value:e.cells(e.getSelectedRowId(),1).getValue()},{type:"input",name:"personil",label:"Jumlah Orang",labelWidth:130,inputWidth:250,value:f,validate:"ValidNumeric"}]}]},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Update"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_clear",offsetLeft:30,value:"Cancel"}]}]);isFormNumeric(s,["personil"]),s.attachEvent("onButtonClick",(function(t){switch(t){case"update":if(!s.validate())return eAlert("Input error!");setDisable(["update","cancel"],s,p);let t=new dataProcessor(Overtime("updatePersonilNeeded"));t.init(s),s.save(),t.attachEvent("onAfterUpdate",(function(t,a,i,l){let r=l.getAttribute("message");switch(a){case"updated":sAlert(r),setEnable(["update","cancel"],s,p),e.cells(e.getSelectedRowId(),5).setValue(s.getItemValue("personil")+" Orang"),closeWindow("input_change_personil");break;case"error":eaAlert(r),setEnable(["update","cancel"],s,p)}}));break;case"cancel":closeWindow("input_change_personil")}}));break;case"hour_revision":if(!e.getSelectedRowId())return eAlert("Pilih baris yang akan di revisi!");var o=createWindow("hour_revision","Revisi Waktu Lembur",510,280);myWins.window("hour_revision").skipMyCloseEvent=!0;let b=getCurrentTime(e,8,9),h=b.labelStart,g=b.labelEnd;var c=o.attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Jam Lembur",list:[{type:"block",list:[{type:"hidden",name:"id",label:"ID",labelWidth:130,inputWidth:250,value:e.getSelectedRowId()},{type:"combo",name:"start_date",label:h,labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:d.startTimes},{type:"combo",name:"end_date",label:g,labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:d.endTimes}]}]},{type:"newcolumn"},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Update"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Clear"}]}]),m=c.getCombo("start_date"),u=c.getCombo("end_date");let v=d.filterStartTime.indexOf(b.start),y=d.filterEndTime.indexOf(b.end);m.selectOption(v),u.selectOption(y),c.attachEvent("onButtonClick",(function(e){switch(e){case"update":setDisable(["update","cancel"],c,o);let e=new dataProcessor(Overtime("updateOvertimeHour"));e.init(c),c.save(),e.attachEvent("onAfterUpdate",(function(e,t,a,i){let l=i.getAttribute("message");switch(t){case"updated":x(),k(null),sAlert(l),setEnable(["update","cancel"],c,o),closeWindow("hour_revision");break;case"error":eaAlert("Kesalahan Waktu Lembur",l),setEnable(["update","cancel"],c,o)}}));break;case"cancel":closeWindow("hour_revision")}}))}}));let g=_.cells("a").attachStatusBar();function v(){var a=e.getRowsNum();g.setText("Total baris: "+a+" ("+t.input_overtime+")")}function x(){_.cells("a").progressOn();e.clearAndLoad(Overtime("getOvertimeGrid",{equal_status:"CREATED",equal_ref:""}),v)}_.cells("a").progressOn(),(e=_.cells("a").attachGrid()).setImagePath("./public/codebase/imgs/"),e.setHeader("No,Task ID,Sub Unit,Bagian,Disivi,Kebutuhan Orang,Status Hari,Tanggal Overtime,Waktu Mulai, Waktu Selesai,Catatan,Makan,Steam,AHU,Compressor,PW,Jemputan,Dust Collector,Mekanik,Listrik,H&N,Status Overtime, Revisi Jam Lembur,Revisi User Approval,Rejection User Approval,Created By,Updated By,Created At"),e.attachHeader("#rspan,#text_filter,#select_filter,#select_filter,#select_filter,#select_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#select_filter,#select_filter,#select_filter,#select_filter,#select_filter,#select_filter,#select_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter"),e.setColSorting("int,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str"),e.setColAlign("center,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left"),e.setColTypes("rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt"),e.setInitWidthsP("5,20,20,20,20,15,15,15,20,20,20,7,7,7,7,7,7,7,7,7,7,10,30,30,30,15,15,25"),e.enableSmartRendering(!0),e.attachEvent("onXLE",(function(){_.cells("a").progressOff()})),e.attachEvent("onRowDblClicked",(function(t,a){k(t),_.cells("b").setText("Proses Personil Lembur : "+e.cells(t,1).getValue()),_.cells("b").expand()})),e.init(),x();var y=_.cells("b").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"add_person",text:"Manage Personil",type:"button",img:"person_16.png"},{id:"delete",text:"Hapus Personil",type:"button",img:"delete.png"},{id:"final",text:"Final Submit",type:"button",img:"update.png"},{id:"hour_revision",text:"Revisi Waktu Lembur",type:"button",img:"clock.png"}]});function k(t){if(t){_.cells("b").progressOn();let a=e.cells(t,1).getValue();formOvtDetailGrid.clearAndLoad(Overtime("getOvertimeDetailGrid",{in_status:"CREATED,REJECTED",equal_task_id:a}),w)}else formOvtDetailGrid.clearAll(),formOvtDetailGrid.callEvent("onGridReconstructed",[]),$("#other_total_ovt_input").html("0")}function w(){n=[],sumGridToElement(formOvtDetailGrid,18,"other_total_ovt_input");for(let e=0;e<formOvtDetailGrid.getRowsNum();e++)n.push(formOvtDetailGrid.cells2(e,27).getValue())}formOvtDetailGrid=_.cells("b").attachGrid(),formOvtDetailGrid.setImagePath("./public/codebase/imgs/"),formOvtDetailGrid.setHeader("No,Task ID,Nama Karyawan,Sub Unit,Bagian,Disivi,Nama Mesin #1,Nama Mesin #2,Pelayanan Produksi,Tanggal Overtime,Waktu Mulai,Waktu Selesai,Status Hari,Jam Efektif,Jam Istirahat,Jam Ril,Jam Lembur,Premi,Nominal Overtime,Makan,Tugas,Status Overtime,Status Terakhir,Created By,Updated By,Created At,Nik Rejector,EmpId"),formOvtDetailGrid.attachHeader("#rspan,#text_filter,#text_filter,#select_filter,#select_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#select_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter"),formOvtDetailGrid.setColSorting("int,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str"),formOvtDetailGrid.setColAlign("center,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left"),formOvtDetailGrid.setColTypes("rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt"),formOvtDetailGrid.setInitWidthsP("5,20,20,20,20,20,15,15,0,15,15,15,10,10,10,10,10,10,10,5,25,10,30,15,15,22,0,0"),formOvtDetailGrid.attachFooter("Total,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#cspan,#stat_total,#stat_total,#stat_total,#stat_total,,<div id='other_total_ovt_input'></div>,,,,,,,,,"),formOvtDetailGrid.enableMultiselect(!0),formOvtDetailGrid.enableSmartRendering(!0),formOvtDetailGrid.attachEvent("onXLE",(function(){_.cells("b").progressOff()})),formOvtDetailGrid.init(),y.attachEvent("onClick",(function(t){switch(t){case"add_person":if(!e.getSelectedRowId())return eAlert("Belum ada lemburan yang di pilih!");if(formOvtDetailGrid.getRowsNum()>=e.cells(e.getSelectedRowId(),5).getValue().replace(" Orang",""))return eaWarning("Warning Kebutuhan Orang!","Jumlah personil sudah cukup!");var s=createWindow("add_person","Detail Overtime",1100,700);myWins.window("add_person").skipMyCloseEvent=!0;const t=reqJsonResponse(Overtime("getDetailOvertime"),"POST",{id:e.getSelectedRowId()},null);var o=s.attachLayout({pattern:"3U",cells:[{id:"a",text:"Detail",height:260},{id:"b",text:"Klik Mesin Untuk Memilih",height:260},{id:"c",text:"Tambah Personil"}]});o.cells("a").attachHTMLString(t.template);let h=getCurrentTime(e,8,9),g=d.filterTime.indexOf(h.start),v=d.filterTime.indexOf(h.end),y=d.filterTime.indexOf(h.start),w=d.filterTime.indexOf(h.end);var c=genWorkTime(d.times,g,v),m=genWorkTime(d.times,y,w),u=o.cells("c").attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Data Lembur",list:[{type:"block",list:[{type:"hidden",name:"overtime_id",label:"Overtime ID",labelWidth:130,inputWidth:250,value:e.getSelectedRowId()},{type:"combo",name:"start_date",label:"Waktu Mulai",labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:c.newStartTime},{type:"combo",name:"end_date",label:"Waktu Selesai",labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:m.newEndTime},{type:"hidden",name:"machine_id",label:"ID Mesin",labelWidth:130,inputWidth:250,readonly:!0},{type:"input",name:"machine_name",label:"Nama Mesin",labelWidth:130,inputWidth:250,readonly:!0}]}]},{type:"newcolumn"},{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Personil Dan Tugas Lembur",list:[{type:"block",list:[{type:"hidden",name:"personil_id",label:"Daftar Personil",labelWidth:130,inputWidth:250,required:!0,readonly:!0},{type:"input",name:"personil_name",label:"Daftar Personil",labelWidth:130,inputWidth:250,required:!0,readonly:!0},{type:"input",name:"notes",label:"Tugas Lembur",labelWidth:130,inputWidth:250,required:!0,rows:3}]}]},{type:"newcolumn"},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"add",className:"button_add",offsetLeft:15,value:"Tambah"},{type:"newcolumn"},{type:"button",name:"clear",className:"button_clear",offsetLeft:30,value:"Clear"}]}]);u.getCombo("start_date");if(u.getCombo("end_date").selectOption(m.newEndTime.length-1),u.attachEvent("onFocus",(function(e,a){"personil_name"===e&&function(){var e=createWindow("add_personil_win","Daftar Personil",900,500);myWins.window("add_personil_win").skipMyCloseEvent=!0,e.attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"save",text:"Simpan",type:"button",img:"ok.png"}]}).attachEvent("onClick",(function(e){switch(e){case"save":l=[],r=[];for(let e=0;e<a.getRowsNum();e++){let t=a.getRowId(e);1==a.cells(t,1).getValue()&&(l.push(t),r.push(a.cells(t,2).getValue()))}u.setItemValue("personil_id",l),u.setItemValue("personil_name",r),closeWindow("add_personil_win")}}));var a=e.attachGrid();function i(){n.map((e=>a.cells(e,1).setDisabled(!0)))}a.setImagePath("./public/codebase/imgs/"),a.setHeader("No,Check,Nama Personil,Sub Unit,Bagian,Divisi"),a.attachHeader("#rspan,#master_checkbox,#text_filter,#select_filter,#select_filter,#select_filter"),a.setColAlign("center,left,left,left,left,left"),a.setColSorting("str,na,str,str,str,str"),a.setColTypes("rotxt,ch,rotxt,rotxt,rotxt,rotxt"),a.setInitWidthsP("5,5,20,20,25,25"),a.enableSmartRendering(!0),a.attachEvent("onXLE",(function(){l.length>0&&l.map((e=>""!==e&&a.cells(e,1).setValue(1))),e.progressOff()})),a.init(),a.clearAndLoad(Overtime("getEmployees",{equal_department_id:t.overtime.department_id,notequal_sub_department_id:5}),i)}()})),t.overtime.machine_ids){o.cells("b").progressOn();var f=o.cells("b").attachGrid();f.setImagePath("./public/codebase/imgs/"),f.setHeader("No,Nama Mesin,Lokasi"),f.setColSorting("int,str,str"),f.setColAlign("center,left,left"),f.setColTypes("rotxt,rotxt,rotxt"),f.setInitWidthsP("5,45,50"),f.enableMultiselect(!0),f.enableSmartRendering(!0),f.attachEvent("onXLE",(function(){o.cells("b").progressOff()})),f.attachEvent("onRowSelect",(function(e,t){let a=f.getSelectedRowId().split(",");if(a.length<=2){let e=[];a.map((t=>{e.push(f.cells(t,1).getValue())})),u.setItemValue("machine_id",f.getSelectedRowId()),u.setItemValue("machine_name",e)}else f.clearSelection(),eaAlert("Oops..","Maksimal 1 operator menjalankan 2 mesin!"),u.setItemValue("machine_id",""),u.setItemValue("machine_name","")})),f.init(),f.clearAndLoad(Overtime("getOvertimeMachine",{ids:t.overtime.machine_ids}))}else o.cells("b").attachHTMLString("<div style='width:100%;height:100%;display:flex;flex-direction:center;justify-content:center;align-items:center;font-family:sans-serif'>No Machine</div>"),o.cells("b").setText("Lembur Umum"),o.cells("b").collapse(),u.hideItem("machine_name");u.attachEvent("onButtonClick",(function(a){switch(a){case"add":if(!u.validate())return eAlert("Input error!");if(formOvtDetailGrid.getRowsNum()>=e.cells(e.getSelectedRowId(),5).getValue().replace(" Orang",""))return eaWarning("Warning Kebutuhan Orang!","Jumlah personil sudah cukup!");setDisable(["add","clear"],u,o.cells("c"));let a=new dataProcessor(Overtime("createPersonilOvertime"));a.init(u),u.save(),a.attachEvent("onAfterUpdate",(function(a,i,n,s){let d=s.getAttribute("message");switch(i){case"inserted":sAlert("Berhasil Menambahkan Record <br>"+d),l=[],r=[],clearAllForm(u,null,null,["start_date","end_date"]),k(e.getSelectedRowId()),t.overtime.machine_ids&&f.clearSelection(),setEnable(["add","clear"],u,o.cells("c"));break;case"error":eAlert("Gagal Menambahkan Record <br>"+d),setEnable(["add","clear"],u,o.cells("c"));break;case"invalid":eaAlert("Terjadi Kesalahan",d),setEnable(["add","clear"],u,o.cells("c"))}}));break;case"cancel":clearAllForm(u,null,null,["start_date","end_date"])}}));break;case"delete":if(!formOvtDetailGrid.getSelectedRowId())return eAlert("Pilih baris yang akan hapus!");reqAction(formOvtDetailGrid,Overtime("personilOvertimeDelete"),1,((t,a)=>{k(e.getSelectedRowId()),a.mSuccess&&sAlert("Sukses Menghapus Record <br>"+a.mSuccess),a.mError&&eAlert("Gagal Menghapus Record <br>"+a.mError)}));break;case"final":if(!e.getSelectedRowId())return eAlert("Pilih baris yang akan di final submit!");if(0===formOvtDetailGrid.getRowsNum())return eaAlert("Peringatan","Data personil lembur belum ada!");dhtmlx.modalbox({type:"alert-warning",title:"Konfirmasi Form Lembur",text:"Anda yakin akan melakukan Final Submit, pastikan data lembur sudah sesuai?",buttons:["Ya","Tidak"],callback:function(t){if(0==t){let t=e.cells(e.getSelectedRowId(),1).getValue();reqJson(Overtime("processOvertime"),"POST",{taskId:t},((e,t)=>{e?eAlert("Gagal melakukan final submit!"):("success"===t.status&&(x(),formOvtDetailGrid.clearAll(),_.cells("b").setText("Proses Personil"),_.cells("b").collapse(),a=[],i=[],l=[],r=[],n=[]),sAlert(t.message))}))}}});break;case"hour_revision":if(!formOvtDetailGrid.getSelectedRowId())return eAlert("Pilih baris yang akan di revisi!");var p=createWindow("hour_revision_detail_input","Revisi Waktu Lembur",510,280);myWins.window("hour_revision_detail_input").skipMyCloseEvent=!0;let O=getCurrentTime(e,8,9),W=d.filterTime.indexOf(O.start),T=d.filterTime.indexOf(O.end),E=d.filterTime.indexOf(O.start),S=d.filterTime.indexOf(O.end);c=genWorkTime(d.times,W,T),m=genWorkTime(d.times,E,S);let I=O.labelStart,D=O.labelEnd;var b=p.attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Jam Lembur",list:[{type:"block",list:[{type:"hidden",name:"id",label:"ID",labelWidth:130,inputWidth:250,value:formOvtDetailGrid.getSelectedRowId()},{type:"combo",name:"start_date",label:I,labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:c.newStartTime},{type:"combo",name:"end_date",label:D,labelWidth:130,inputWidth:250,required:!0,validate:"NotEmpty",options:m.newEndTime}]}]},{type:"newcolumn"},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Update"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Clear"}]}]);let C=b.getCombo("start_date"),A=b.getCombo("end_date"),R=getCurrentTime(formOvtDetailGrid,10,11),L=c.filterStart.indexOf(R.start),G=m.filterEnd.indexOf(R.end);C.selectOption(L),A.selectOption(G),b.attachEvent("onChange",(function(e,t){"start_date"!==e&&"end_date"!==e||checkRevisionTime(d.filterTime,C.getSelectedValue(),A.getSelectedValue(),["update"],b)})),checkRevisionTime(d.filterTime,C.getSelectedValue(),A.getSelectedValue(),["update"],b),b.attachEvent("onButtonClick",(function(t){switch(t){case"update":setDisable(["update","cancel"],b,p);let t=new dataProcessor(Overtime("updateOvertimeDetailHour"));t.init(b),b.save(),t.attachEvent("onAfterUpdate",(function(t,a,i,l){let r=l.getAttribute("message");switch(a){case"updated":k(e.getSelectedRowId()),sAlert(r),setEnable(["update","cancel"],b,p),closeWindow("hour_revision_detail_input");break;case"error":eaAlert("Kesalahan Waktu Lembur",r),setEnable(["update","cancel"],b,p)}}));break;case"cancel":closeWindow("hour_revision_detail_input")}}))}}))}
    
JS;

header('Content-Type: application/javascript');
echo $script;