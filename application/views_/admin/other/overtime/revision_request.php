<?php 
if ((strpos(strtolower($_SERVER['SCRIPT_NAME']), strtolower(basename(__FILE__)))) !== false) { // NOT FALSE if the script"s file name is found in the URL
    header('HTTP/1.0 403 Forbidden');
    die('<h2>Direct access to this page is not allowed.</h2>');
}

$script = <<< "JS"

	function showReqRevOvertime(){var e,t,a,r=legendGrid(),i=[],l=[],s={department_id:{url:Overtime("getDepartment"),reload:!0},sub_department_id:{url:Overtime("getSubDepartment")},division_id:{url:Emp("getDivision")}},n=mainTab.cells("other_pengajuan_revisi_lembur").attachTabbar({pattern:"1C",tabs:[{id:"a",text:"Form Pengajuan Revisi Lembur",active:!0},{id:"b",text:"Daftar Pengajuan Revisi Lembur"}]}),o=(e=n.cells("a").attachForm([{type:"fieldset",offsetTop:30,offsetLeft:30,label:"Form Revisi Lembur",list:[{type:"editor",name:"description",label:"Keterangan",labelWidth:130,inputWidth:900,inputHeight:200,required:!0},{type:"input",name:"task_ids",label:"Task ID Lembur",labelWidth:130,inputWidth:350,required:!0,rows:3,readonly:!0},{type:"combo",name:"department_id",label:"Sub Unit",labelWidth:130,inputWidth:350,required:!0},{type:"combo",name:"sub_department_id",label:"Bagian",labelWidth:130,inputWidth:350,required:!0},{type:"hidden",name:"filename",label:"Filename",readonly:!0},{type:"upload",name:"file_uploader",inputWidth:420,url:AppMaster("fileUpload",{save:!1,folder:"overtimes_revision_requests"}),swfPath:"./public/codebase/ext/uploader.swf",swfUrl:AppMaster("fileUpload")},{type:"block",offsetTop:30,list:[{type:"button",name:"add",className:"button_add",offsetLeft:15,value:"Tambah"},{type:"newcolumn"},{type:"button",name:"clear",className:"button_clear",offsetLeft:30,value:"Clear"}]}]}])).getCombo("department_id");e.getCombo("sub_department_id");function d(){if(!e.validate())return eAlert("Input error!");setDisable(["add","clear"],e,n.cells("a"));let t=new dataProcessor(Overtime("addRevisionRequest"));t.init(e),e.save(),t.attachEvent("onAfterUpdate",(function(t,a,r,l){let o=l.getAttribute("message");switch(a){case"inserted":sAlert(o),clearAllForm(e,s),clearUploader(e,"file_uploader"),setEnable(["add","clear"],e,n.cells("a")),m(),i=[];break;case"error":eAlert(o),setEnable(["add","clear"],e,n.cells("a"))}}))}o.load(Overtime("getDepartment",{equal_id:userLogged.deptId})),o.attachEvent("onChange",(function(t,a){clearComboReload(e,"sub_department_id",Overtime("getSubDepartment",{equal_id:userLogged.subId}))})),e.attachEvent("onFocus",(function(e,t){"task_ids"===e&&x(!1)})),e.attachEvent("onBeforeFileAdd",(async function(r,i){!async function(e,r){if(e.validate()){var i=r.filename.split(".").pop();if("png"==i||"jpg"==i||"jpeg"==i)if(r.size>5e6)t=!0,eAlert("Tidak boleh melebihi 5 MB!");else{if(!(a>0))return a++,!0;eAlert("Maksimal 1 file"),t=!0}else eAlert("Hanya png, jpg & jpeg saja yang bisa diupload!"),t=!0}else eAlert("Input error!")}(e,{filename:r,size:i})})),e.attachEvent("onBeforeFileUpload",(function(a,r,i){if(!t)return!0;clearUploader(e,"file_uploader"),eAlert("File error silahkan upload file sesuai ketentuan!"),t=!1})),e.attachEvent("onButtonClick",(function(a){switch(a){case"add":const a=e.getUploader("file_uploader");-1===a.getStatus()?t?(a.clear(),eAlert("File error silahkan upload file sesuai ketentuan!"),t=!1):a.upload():d();break;case"clear":clearAllForm(e,s)}})),e.attachEvent("onUploadFile",(function(t,a){e.setItemValue("filename",a),d()}));var c=n.cells("b").attachLayout({pattern:"3J",cells:[{id:"a",text:"Daftar Pengajuan Revisi"},{id:"b",text:"Catatan Revisi",collapse:!0,width:450},{id:"c",text:"Detail Revisi",collapse:!0}]}),u=c.cells("a").attachStatusBar();function f(){let e=p.getRowsNum();u.setText("Total baris: "+e+" ("+r.revision_overtime+")")}var p=c.cells("a").attachGrid();function m(){c.cells("a").progressOn();let e=$("#other_start_ovt_rev").val(),t=$("#other_end_ovt_rev").val(),a=$("#other_status_ovt_rev").val(),r={equal_sub_department_id:userLogged.subId,betweendate_created_at:e+","+t};"ALL"!=a&&("ACTIVE"==a?r.in_status="CREATED,PROCESS":r.equal_status=a),c.cells("b").attachHTMLString("<div style='width:100%;height:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;'><p style='font-family:sans-serif'>Tidak ada revisi dipilih</p></div>"),p.clearAndLoad(Overtime("getRevOvtGrid",r),f)}p.setImagePath("./public/codebase/imgs/"),p.setHeader("No,Task ID,Deskripsi,Bagian,Sub Bagian,Status,Created By,Updated By,DiBuat"),p.attachHeader("#rspan,#text_filter,#text_filter,#select_filter,#select_filter,#select_filter,#text_filter,#text_filter,#text_filter"),p.setColSorting("int,str,str,str,str,str,str,str,str"),p.setColTypes("rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt"),p.setColAlign("center,left,left,left,left,left,left,left,left"),p.setInitWidthsP("5,20,35,20,20,20,20,20,25"),p.enableSmartRendering(!0),p.attachEvent("onXLE",(function(){c.cells("a").progressOff()})),p.attachEvent("onRowDblClicked",(function(e,t){c.cells("a").expand(),_(e)})),p.attachEvent("onRowSelect",(function(e,t){"CREATED"!=p.cells(e,5).getValue()?(b.disableItem("desc_rev"),b.disableItem("cancel"),g.disableItem("add"),g.disableItem("delete")):(b.enableItem("desc_rev"),b.enableItem("cancel"),g.enableItem("add"),g.enableItem("delete"))})),p.init();var v=c.cells("c").attachGrid();function _(e=null){e?(c.cells("c").progressOn(),c.cells("c").expand(),v.clearAndLoad(Overtime("getRevOvtDtlGrid",{taskId:e})),c.cells("b").expand(),reqJson(Overtime("getRevision"),"POST",{taskId:e},((e,t)=>{c.cells("b").attachForm([{type:"block",offsetLeft:5,list:[{type:"input",name:"task_id",label:"Task ID",labelWidth:130,inputWidth:385,readonly:!0,required:!0,value:t.revision.task_id},{type:"editor",name:"description",label:"Keterangan",labelWidth:130,inputWidth:385,inputHeight:200,required:!0,value:t.revision.description},{type:"editor",name:"response",label:"Tanggapan SDM",labelWidth:130,inputWidth:385,inputHeight:210,required:!0,value:t.revision.response}]}])}))):(c.cells("c").collapse(),c.cells("b").collapse(),v.clearAll())}v.setImagePath("./public/codebase/imgs/"),v.setHeader("No,Task ID,,Created By,Updated By,DiBuat"),v.setHeader("No,Task ID,Nama Karyawan,Bagian,Sub Bagian,Nama Mesin #1,Nama Mesin #2,Pelayanan Produksi,Tanggal Overtime,Waktu Mulai,Waktu Selesai,Status Hari,Jam Efektif,Jam Istirahat,Jam Ril,Jam Lembur,Premi,Nominal Overtime,Makan,Biaya Makan,Tugas,Status Overtime,DiBuat"),v.attachHeader("#rspan,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter"),v.setColSorting("int,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str"),v.setColTypes("rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt"),v.setColAlign("center,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left"),v.setInitWidthsP("5,20,20,20,20,20,20,20,20,20,20,15,15,15,15,15,15,15,15,15,30,25"),v.enableSmartRendering(!0),v.enableMultiselect(!0),v.attachEvent("onXLE",(function(){c.cells("c").progressOff()})),v.attachEvent("onRowSelect",(function(e,t){"CREATED"!=p.cells(p.getSelectedRowId(),5).getValue()?(g.disableItem("add"),g.disableItem("delete")):(g.enableItem("add"),g.enableItem("delete"))})),v.init();var b=c.cells("a").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"refresh",text:"Refresh",type:"button",img:"refresh.png"},{id:"desc_rev",text:"Revisi Deskripsi",type:"button",img:"edit.png"},{id:"cancel",text:"Batalkan Revisi",type:"button",img:"messagebox_critical.png"},{id:"attachment",text:"Lihat Attachment",type:"button",img:"attachment.png"}]});let h=filterForMonth(new Date);c.cells("a").attachMenu({icon_path:"./public/codebase/icons/",items:[{id:"search",text:"<div style='width:100%'>Search: <input type='text' id='other_start_ovt_rev' readonly value='"+h.start+"' /> - <input type='text' id='other_end_ovt_rev' readonly value='"+h.end+"' /> <button id='other_btn_ftr_ovt_rev'>Proses</button> | Status: <select id='other_status_ovt_rev'><option>ALL</option><option selected value='ACTIVE'>AKTIF (CREATED & PROCESS)</option><option>PROCESS</option><option>CANCELED</option><option>REJECTED</option><option>CLOSED</option></select></div>"}]}),new dhtmlXCalendarObject(["other_start_ovt_rev","other_end_ovt_rev"]);$("#other_btn_ftr_ovt_rev").on("click",(function(){checkFilterDate($("#other_start_ovt_rev").val(),$("#other_end_ovt_rev").val())&&m()})),$("#other_status_ovt_rev").on("change",(function(){m()})),b.attachEvent("onClick",(function(e){switch(e){case"refresh":m(),_();break;case"desc_rev":if(!p.getSelectedRowId())return eAlert("Pilih permintaan revisi yang akan diupdate!");var t=createWindow("desc_win","Update Deskripsi Revisi",1100,550);myWins.window("desc_win").skipMyCloseEvent=!0,reqJson(Overtime("getDescription"),"POST",{taskId:p.getSelectedRowId()},((e,a)=>{var r=t.attachForm([{type:"fieldset",offsetLeft:30,offsetTop:30,label:"Form Revisi",list:[{type:"block",list:[{type:"hidden",name:"task_id",value:a.task_id},{type:"editor",name:"description",label:"Deskripsi",labelWidth:130,inputWidth:800,inputHeight:300,value:a.description}]},{type:"block",offsetLeft:30,offsetTop:10,list:[{type:"button",name:"update",className:"button_update",offsetLeft:15,value:"Update"},{type:"newcolumn"},{type:"button",name:"cancel",className:"button_no",offsetLeft:30,value:"Cancel"}]}]}]);r.attachEvent("onButtonClick",(function(e){switch(e){case"update":setDisable(["update","cancel"],r,t);let e=new dataProcessor(Overtime("updateRevOvtDesc"));e.init(r),r.save(),e.attachEvent("onAfterUpdate",(function(e,a,i,l){let s=l.getAttribute("message");switch(a){case"updated":m(),_(p.getSelectedRowId()),sAlert(s),setEnable(["update","cancel"],r,t),closeWindow("desc_win");break;case"error":eaAlert("Update Gagal",s),m(),setEnable(["update","cancel"],r,t)}}));break;case"cancel":closeWindow("desc_win")}}))}));break;case"cancel":if(!p.getSelectedRowId())return eAlert("Pilih permintaan revisi yang akan dibatalkan!");dhtmlx.modalbox({type:"alert-error",title:"Pembatalan Revisi",text:"Anda yakin akan membatalkan permintaan revisi "+p.getSelectedRowId()+"?",buttons:["Ya","Tidak"],callback:function(e){0==e&&reqJson(Overtime("cancelRevOvt"),"POST",{taskId:p.getSelectedRowId()},((e,t)=>{"success"===t.status?(m(),sAlert(t.message),_(null)):(m(),eaAlert(t.message))}))}});break;case"attachment":if(!p.getSelectedRowId())return eAlert("Pilih permintaan revisi!");reqJson(Overtime("viewAttachment"),"POST",{taskId:p.getSelectedRowId()},((e,t)=>{if("success"===t.status){var a=createWindow("other_ovt_rev_attachment","Attachment Revisi: "+p.getSelectedRowId(),800,500);myWins.window("other_ovt_rev_attachment").skipMyCloseEvent=!0,a.attachHTMLString(t.template)}}))}}));var g=c.cells("c").attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"add",text:"Tambah",type:"button",img:"add.png"},{id:"delete",text:"Hapus",type:"button",img:"delete.png"}]});function x(t=!1){var a=createWindow("rev_ovt_form_win","Daftar Lembur (1 Minggu Terakhir)",1100,600);myWins.window("rev_ovt_form_win").skipMyCloseEvent=!0,a.attachToolbar({icon_path:"./public/codebase/icons/",items:[{id:"save",text:"Simpan",type:"button",img:"ok.png"}]}).attachEvent("onClick",(function(a){switch(a){case"save":if(t){l=[];for(let e=0;e<s.getRowsNum();e++){let t=s.getRowId(e);1==s.cells(t,1).getValue()&&l.push(s.cells(t,2).getValue())}let e=p.cells(p.getSelectedRowId(),1).getValue();reqJson(Overtime("addPersonRevisionRequest"),"POST",{taskId:l,revTaskId:e},((t,a)=>{"success"===a.status&&(l=[],_(e),sAlert(a.message))}))}else{i=[];for(let e=0;e<s.getRowsNum();e++){let t=s.getRowId(e);1==s.cells(t,1).getValue()&&i.push(s.cells(t,2).getValue())}e.setItemValue("description",i),e.setItemValue("task_ids",i)}closeWindow("rev_ovt_form_win")}}));var r=a.attachStatusBar();a.progressOn();var s=a.attachGrid();s.setImagePath("./public/codebase/imgs/"),s.setHeader("No,Check,Task ID,Nama Karyawan,Bagian,Sub Bagian,Nama Mesin #1,Nama Mesin #2,Pelayanan Produksi,Tanggal Overtime,Waktu Mulai,Waktu Selesai,Status Hari,Jam Efektif,Jam Istirahat,Jam Ril,Jam Lembur,Premi,Nominal Overtime,Makan,Biaya Makan,Tugas,Status Overtime,DiBuat"),s.attachHeader("#rspan,#master_checkbox,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter"),s.setColSorting("int,na,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str"),s.setColTypes("rotxt,ch,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt,rotxt"),s.setColAlign("center,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left"),s.setInitWidthsP("5,5,20,20,20,20,20,20,20,20,20,20,15,15,15,15,15,15,15,15,15,30,25"),s.enableSmartRendering(!0),s.setEditable(!0),s.attachEvent("onXLE",(function(){a.progressOff()})),s.init();new Date;s.clearAndLoad(Overtime("getWindowOvertimeGrid",{equal_status:"CLOSED",equal_sub_department_id:userLogged.subId,notequal_payment_status:"VERIFIED"}),(function(){let e=s.getRowsNum();r.setText("Total baris: "+e),t?l.length>0&&l.map((e=>s.cells(e,1).setValue(1))):i.length>0&&i.map((e=>s.cells(e,1).setValue(1)))}))}g.attachEvent("onClick",(function(e){switch(e){case"add":if(!p.getSelectedRowId())return eAlert("Pilih permintaan revisi yang akan ditambahkan!");x(!0);break;case"delete":reqAction(v,Overtime("cancelRevOvtDetail"),1,((e,t)=>{_(p.getSelectedRowId()),t.mSuccess&&sAlert("Sukses Menghapus Record <br>"+t.mSuccess),t.mError&&eAlert("Gagal Menghapus Record <br>"+t.mError)}))}})),m(),_()}

JS;

header('Content-Type: application/javascript');
echo $script;